<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7404418VP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-J7404418VP');
  </script>

  <style>
    model-viewer {
      width: 256px;
      height: 256px;
      background-color: #7d7d7d;
    }
  </style>

  <link rel="icon" href="../documents/images/logo3d_icon.png" type="image/x-icon" />
  <!--
  <link rel="icon" href="../documents/images/logo3d_2_small.png" type="image/x-icon" />
  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.0/css/all.css">

  <link rel="stylesheet" href="../documents/css/style.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  

  <title>MaterialX Learn</title>
  <link rel="icon" type="images" href="../documents/images/favicon.png" class="img-fluid">

</head>

<body>
      <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
    <script> mermaid.initialize({ startOnLoad: false, theme: document.body.classList.contains("vscode-dark") || document.body.classList.contains("vscode-high-contras") ? "dark" : "base", themeVariables: { primaryColor: "#F1F1F1", primaryBorderColor: "#000000", lineColor: "#000000", secondaryColor: "#EFEFFF", tertiaryColor: "#EEEEEE" } }); </script>

    <script src="../documents/js/ui_helpers.js"> </script>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
                ? 'dark'
                : 'default'
        });
    </script>

    <!-- Navigation  -->
    <nav class="navbar sticky-top navbar-expand-lg bg-dark-subtle" data-bs-theme="dark">
        <div class="container-md container-fluid">
            <a class="navbar-brand" href="../index.html">
                <h5><img src="../documents/images/logo3d_2_small.png" alt="MaterialX Learn"
                        class="rounded d-inline-block align-text-center" width="50px">
                    MaterialX Learn</h5>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainMenuContent"
                aria-controls="mainMenuContent" aria-expanded="false" aria-label="Toggle top menu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainMenuContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link" href="../index.html" role="button">
                            Home
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Learn
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="../documents/nodes_and_nodegraphs.html">
                                    Nodes and Graphs
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/node_definitions.html">
                                    Node Definitions
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/documents.html">
                                    Documents
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                            data-bs-auto-close="outside">Reference</a>
                        <ul class="dropdown-menu shadow">
                            <li><a class="dropdown-item"
                                    href="../documents/definitions/definitions_by_group.html">Library
                                    (By Group)</a></li>
                            <li><a class="dropdown-item"
                                    href="../documents/definitions/all_definitions.html">Library
                                    (All)</a></li>
                            <li><a class="dropdown-item"
                                    href="../documents/definitions/library_glossary.html">Library
                                    Glossary</a></li>
                            <li><a class="dropdown-item" href="https://materialx.org/docs/api/annotated.html"
                                    target="_blank"><img src="../documents/images/MaterialXLogo_200x155.png"
                                        style="width:20px"> C++ API</a></li>

                            <li class="dropend">
                                <a href="#" class="dropdown-item dropdown-toggle" data-bs-toggle="dropdown">Library
                                    Revisions</a>
                                <ul class="dropdown-menu shadow">
                                    <li><a class="dropdown-item" href="../documents/mtlx_1388_vs_1389.html">
                                            1.38.8 vs 1.38.9
                                            (current)</a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1387_vs_1388.html">
                                            1.38.7 vs 1.38.8
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1386_vs_1387.html">
                                            1.38.6 vs 1.38.7
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1385_vs_1386.html">
                                            1.38.5 vs 1.38.6
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1384_vs_1385.html">
                                            1.38.4 vs 1.38.5
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1383_vs_1384.html">
                                            1.38.3 vs 1.38.4
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1382_vs_1383.html">
                                            1.38.2 vs 1.38.3
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1381_vs_1382.html">
                                            1.38.1 vs 1.38.2
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1380_vs_1381.html">
                                            1.38.0 vs 1.38.1
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_138_vs_1389.html"> 1.38.0
                                            vs 1.38.9
                                            (current)</a></li>
                                </ul>
                            </li>

                            <div class="dropdown-divider"></div>
                            <li>
                                <a class="dropdown-item" href="../documents/using_library.html">
                                    <img src="../documents/images/info-circle.svg"> Library User Guide
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Utilities</a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="../documents/gltfViewer.html">
                                    glTF Model Viewer
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/mermaidChecker.html">
                                    Graph Visualizer
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../javascript/mtlx_js_utilities.html">
                                  Graph Generator
                                </a>
                            </li>
                            <li>
                            <a class="dropdown-item" href="../javascript/viewer/dist/index_out.html">
                                Shader Preview
                            </a>
                            </li>                            
                            <li>
                            <a class="dropdown-item" href="../documents/mtlx_utilities.html">
                                Python Utilities
                            </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Develop</a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="../documents/python_MaterialX.html">
                                    Notebooks
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/jupyter_example.html">
                                    Examples
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/hosting.html">
                                    Hosting
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Workflows</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="../documents/workflow_usd.html">USD and
                                    MaterialX</a></li>
                            <li><a class="dropdown-item" href="../documents/workflow_gltf.html">glTF and
                                    MaterialX</a></li>
                            <li><a class="dropdown-item" href="../documents/workflow_ocio.html">OCIO and
                                    MaterialX</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Design</a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="../documents/design.html">
                                    UX Design
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/implementation.html">
                                    Implementation
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../documents/about.html" role="button">
                            About
                        </a>
                    </li>
                    <!--INDEX_ITEM-->
                </ul>
            </div>
        </div>
    </nav>

  <!-- Section Information -->
  <section class="py-0 px-0 g-0">
    <div class="container-fluid p-4">
          <div class="container-fluid p-4">
        <h2>Javascript Utilities</h2>

        The following is a set of utilities to work with MaterialX using it's Javascript
        packages.

        <h3>Document Graphing</h3>
        <p>A MaterialX file can be loaded in and previewed as text. This text can be converted to a `Mermaid` graph
            which can then be used to visualize using the
            <a href="../documents/mermaidChecker.html">Mermaid Visualizer</a>
        </p>
        <button class="btn btn-outline-primary shadow-sm" id="loadMaterialXButton">Load MaterialX Document</button>
        <div class="row flex-nowrap ">
            <div class="col-sm-12 p-2">
                <textarea class="form-control form-control-sm" data-bs-theme="dark" id="materialXTextArea" rows="15"
                    style="width: 100%;" placeholder="Loaded MaterialX document will be displayed here"></textarea><br>
            </div>
        </div>

        <p>
            <hr>

            <!-- Button to generate graph -->
            <button class="btn btn-outline-primary shadow-sm" id="generateGraphButton">Generate Graph</button>
            <br>
            <label for="graphOrientation">Graph Orientation:</label>
            <select id="graphOrientation">
                <option value="0">Left to Right</option>
                <option value="1">Top to Bottom</option>
            </select>
            <br>
        <div class="row flex-nowrap">
            <div class="col-sm-12 p-2">
                <textarea class="form-control form-control-sm" data-bs-theme="dark" id="materialXGraph" rows="15"
                    style="width: 100%;" placeholder="Generated Mermaid Graph will be displayed here"></textarea><br>
            </div>
        </div>

    </div>

    <script src="JsMaterialXCore.js" type="text/javascript"></script>
    <script type="text/javascript">
        console.log("Load MaterialX");

        let mx = null;
        let doc = null;
        let renderableItems = [];

        function doStuff(mx) {
            doc = mx.createDocument();
            console.log(mx.prettyPrint(doc));
        }

        function loadMaterialX() {
            return new Promise((resolve, reject) => {
                MaterialX().then((mtlx) => {
                    // Save the MaterialX instance to the global variable
                    mx = mtlx;

                    console.log("MaterialX loaded");

                    // Resolve the promise
                    resolve();
                }).catch((error) => {
                    // Reject the promise if there's an error
                    reject(error);
                });
            });
        }

        // Call the asynchronous function and then perform additional logic
        loadMaterialX().then(() => {
            // Additional logic after MaterialX is loaded
            console.log("MaterialX is loaded");
            //doStuff(mx);
        }).catch((error) => {
            console.error("Error loading MaterialX:", error);
        });

        // Attach event listener to the button
        document.getElementById('loadMaterialXButton').addEventListener('click', () => {
            // Open file dialog
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.mtlx';
            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    loadMaterialXDocument(file, file.name);
                }
            });

            // Trigger the file dialog
            input.click();
        });

        function loadMaterialXDocument(file, fileName) {
            if (mx) {
                // Load the content from the specified file (replace this with actual loading logic)
                console.log("Loading content from file:", file.name);

                const reader = new FileReader();
                reader.readAsText(file, 'UTF-8');

                reader.onload = function (e) {
                    // Display the contents of the file in the output div
                    let fileContents = e.target.result;
                    //console.log(e.target);

                    (async () => {
                        try {
                            doc = mx.createDocument();
                            const readOptions = new mx.XmlReadOptions();
                            readOptions.readXIncludes = false;
                            await mx.readFromXmlString(doc, fileContents, '', readOptions);
                            //console.log('Read document:', mx.prettyPrint(doc));

                            // Update the text area with the file contents
                            let textArea = document.getElementById('materialXTextArea');
                            //console.log('update text area:', textArea);
                            textArea.value = fileContents;

                            renderableItems = doc.getMaterialNodes();
                            console.log('Renderable Items:', renderableItems);
                            // Update selection for renderables
                            let renderableItemSelect = document.getElementById('renderableItem');
                            // Remove any previous children
                            while (renderableItemSelect.firstChild) {
                                renderableItemSelect.removeChild(renderableItemSelect.firstChild);
                            }
                            for (let i = 0; i < renderableItems.length; i++) {
                                let item = renderableItems[i];
                                let option = document.createElement('option');
                                option.value = i;
                                option.text = item.getNamePath();
                                renderableItemSelect.appendChild(option);
                            }

                        } catch (error) {
                            console.error(error);
                        }
                    })();

                };

            } else {
                console.error("MaterialX is not initialized");
            }
        }

        /*
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize CodeMirror for XML syntax highlighting
            const xmlTextarea = document.getElementById('materialXTextArea');
            const editor = CodeMirror.fromTextArea(xmlTextarea, {
                mode: 'application/xml',
                lineNumbers: true,
                theme: 'monokai' // You can choose a different theme
            });
            
            // Update CodeMirror whenever the textarea content changes
            editor.on('change', () => {
                // Copy the content from CodeMirror back to the textarea
                console.log('Content changed');
                xmlTextarea.value = editor.getValue();
            });
            editor.on('input', () => {
                // Copy the content from CodeMirror back to the textarea
                console.log('Content changed');
                xmlTextarea.value = editor.getValue();
            });
        }); */

        // Add event handler for generate graph
        document.getElementById('generateGraphButton').addEventListener('click', () => {
            console.log('Generate Graph');
            // Generate the graph
            let graphio = new mx.MermaidGraphIo.create();

            // TODO: Add UI options for these.
            let graphOptions = new mx.GraphIoGenOptions()
            graphOptions.setWriteGraphHeader(true)
            graphOptions.setWriteCategories(false)
            graphOptions.setWriteSubgraphs(true)

            // Set the orientation from UI
            let orientation = document.getElementById('graphOrientation').value;
            if (orientation == 0) {
                graphOptions.setOrientation(mx.GraphOrientation.LEFT_RIGHT)
            } else {
                graphOptions.setOrientation(mx.GraphOrientation.TOP_DOWN)
            }
            graphio.setGenOptions(graphOptions)

            let outputList = new mx.StringVec();
            let graphOutput = graphio.write(doc, outputList);
            //console.log('GraphOutput:', graphOutput);
            let graphTextArea = document.getElementById('materialXGraph');
            graphTextArea.value = graphOutput;
        });

    </script>

    </div>
  </section>

    <footer class="bg-dark-subtle footer text-white py-2 pt-2" data-bs-theme="dark">
    <div class="container">
      <ul class="social-icons">
        <button class="btn btn-outline" type="button">
          <a href="https://github.com/kwokcb/MaterialX_Learn" target="_blank"><i class="fab fa-github fa-2x"
              style="color: #ffffff;"></i></a>
        </button>
        <button class="btn btn-outline " type="button">
          <a href="https://www.linkedin.com/in/bernard-kwok/" target="_blank"><i class="fab fa-linkedin-in fa-2x"
              style="color: #0082ca;"></i></a>
        </button>
      </ul>
      <p>&copy; 2022-2024 NanMu Consulting.</p>
    </div>
  </footer>

</body>

</html>