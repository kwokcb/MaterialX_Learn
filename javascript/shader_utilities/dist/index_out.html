<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Authors: Bernard Kwok and Matthew Kwok. Resource site for the
  Academy Software Foundation MaterialX -- an open source industry standard for 3D / Cg materials.
  Resources include interaction with related standards: OpenUSD, Khronos glTF, OpenImageIO.">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7404418VP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-J7404418VP');
  </script>

  <style>
    model-viewer {
      width: 256px;
      height: 256px;
      background-color: #7d7d7d;
    }
  </style>

  <!-- <link rel="icon" href="../../../documents/images/logo3d_icon.png" type="image/x-icon" /> -->
  <!--
  <link rel="icon" href="../../../documents/images/logo3d_2_small.png" type="image/x-icon" />
  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.0/css/brands.min.css"> 

  <link rel="stylesheet" href="../../../documents/css/style.css">

  <!-- 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  -->

  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

  <title>MaterialXToy ShaderGen</title>

  <!-- Syntax styles -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/night.min.css">
  <!--
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/material-ocean.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/blackboard.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/nord.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/base16-dark.min.css">
  -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/xml/xml.min.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/json/json.min.js"></script> -->

  <style>
    /* Canvas styling */
    .canvas-container {
      position: relative;
      width: 100%;
      padding-bottom: 100%;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      /* Set border and color */
      /* border: 1px solid #b0b6b8; */
      border:solid thin lightskyblue;
    }

    .inverted-svg {
      filter: invert(1);
    }

    body {
      font-family: Arial
    }

    textarea {
      border:solid thin lightskyblue;
    }

    .CodeMirror {
      font-size: 12px;
      height: 600px;
      border-radius: 2%;
      border:solid thin lightskyblue;
    }
  </style>
  <link rel="icon" type="images" href="./Icons/logo_wave3.png" type="image/x-icon" class="img-fluid">
<script defer src="main.js"></script></head>


  <title>MaterialX Learn</title>
  <link rel="icon" type="images" href="../../../documents/images/logo3d_icon.png" type="image/x-icon" class="img-fluid">

</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
  <script src="../../../documents/js/ui_helpers.js"></script>
  
  </script>  
   
  <!-- Navigation_Area-->
<nav class="navbar sticky-top navbar-expand-lg bg-dark-subtle" data-bs-theme="dark">
    <div class="container-md container-fluid">
        <a class="navbar-brand" href="../../../index.html">
            <h5><img src="../../../documents/images/logo3d_2_small.png" alt="MaterialX Learn"
                    class="rounded d-inline-block align-text-center" width="50px">
                MaterialX Learn</h5>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainMenuContent"
            aria-controls="mainMenuContent" aria-expanded="false" aria-label="Toggle top menu">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mainMenuContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                    <a class="nav-link" href="../../../index.html" role="button">
                        Home
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Learn
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="../../../documents/nodes_and_nodegraphs.html">
                                Nodes and Graphs
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="../../../documents/node_definitions.html">
                                Node Definitions
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="../../../documents/documents.html">
                                Documents
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="../../../documents/presentations.html">
                                Presentations and Media
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                        data-bs-auto-close="outside">Reference</a>
                    <ul class="dropdown-menu shadow">
                        <li><a class="dropdown-item"
                                href="../../../documents/definitions/definitions_by_group.html">Library
                                (By Group)</a></li>
                        <li><a class="dropdown-item"
                                href="../../../documents/definitions/all_definitions.html">Library
                                (All)</a></li>
                        <li><a class="dropdown-item"
                                href="../../../documents/definitions/library_glossary.html">Library
                                Glossary</a></li>
                        <li><a class="dropdown-item" href="https://materialx.org/docs/api/annotated.html"
                                target="_blank"><img src="../../../documents/images/MaterialXLogo_200x155.png"
                                    style="width:20px"> C++ API</a></li>

                        <li class="dropend">
                            <a href="#" class="dropdown-item dropdown-toggle" data-bs-toggle="dropdown">Library
                                Revisions</a>
                            <ul class="dropdown-menu shadow">
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1389_vs_1390.html">
                                        1.38.9 vs 1.39.0</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1388_vs_1389.html">
                                        1.38.8 vs 1.38.9</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1387_vs_1388.html">
                                        1.38.7 vs 1.38.8</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1386_vs_1387.html">
                                        1.38.6 vs 1.38.7</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1385_vs_1386.html">
                                        1.38.5 vs 1.38.6</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1384_vs_1385.html">
                                        1.38.4 vs 1.38.5</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1383_vs_1384.html">
                                        1.38.3 vs 1.38.4</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1382_vs_1383.html">
                                        1.38.2 vs 1.38.3</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1381_vs_1382.html">
                                        1.38.1 vs 1.38.2</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1380_vs_1381.html">
                                        1.38.0 vs 1.38.1</a></li>
                                <li><a class="dropdown-item" href="../../../documents/mtlx_1380_vs_1390.html">
                                        1.38.0 vs 1.39.0</a></li>
                            </ul>
                        </li>

                        <div class="dropdown-divider"></div>
                        <li>
                            <a class="dropdown-item" href="../../../documents/using_library.html">
                                <img src="../../../documents/images/info-circle.svg"> Library User Guide
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Utilities</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../../../javascript/node_editor/index_out.html">Node Graph Editor</a></li>
                        <li><a class="dropdown-item" href="../../../javascript/shader_editor/dist/index_out.html">Shader Graph Editor</a></li>
                        <li><a class="dropdown-item" href="../../../javascript/shader_utilities/dist/index_out.html">Shader Utilities</a></li>
                        <li><a class="dropdown-item" href="../../../javascript/graphing_utilities.html">Node Graph Utilities</a></li>
                        <li><a class="dropdown-item" href="../../../documents/mermaidChecker.html">Graph Visualizer</a></li>
                        <li><a class="dropdown-item" href="../../../documents/gltfViewer.html">glTF Model Viewer</a></li>
                        <li><a class="dropdown-item" href="../../../documents/mtlx_utilities.html">Python Modules</a></li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Develop</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../../../documents/python_MaterialX.html">Notebooks</a></li>
                        <li><a class="dropdown-item" href="../../../documents/jupyter_example.html">Examples</a></li>
                        <li><a class="dropdown-item" href="../../../documents/hosting.html">Hosting</a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Workflows</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../../../documents/workflow_usd.html">USD and MaterialX</a></li>
                        <li><a class="dropdown-item" href="../../../documents/workflow_gltf.html">glTF and MaterialX</a></li>
                        <li><a class="dropdown-item" href="../../../documents/workflow_ocio.html">OCIO and MaterialX</a></li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Design</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../../../documents/design.html">UX Design</a></li>
                        <li><a class="dropdown-item" href="../../../documents/property_editor_ui.html">Property Editor UX</a></li>
                        <li><a class="dropdown-item" href="https://guannan-kwok.github.io/assetLibrary/materialx/" target="_blank">Graphic Design</a></li>
                        <li><a class="dropdown-item" href="../../../documents/implementation.html">Implementation</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../../documents/about.html" role="button">
                        About
                    </a>
                </li>
                <!--INDEX_ITEM-->
            </ul>
        </div>
    </div>
</nav>

  <!-- Section Information -->
  <section class="py-0 px-0 g-0">
    <div class="container-fluid p-4">
      
  <script type="text/javascript" src="JsMaterialXGenShader.js"></script>

  <div class="container-fluid p-2">

    <!-- Header -->
    <h2 class="bg-gradient p-2 rounded-4"><img class="rounded-4" src="./Icons/logo_wave3.png" width="48px">
      MaterialX Shader Generation and Reflection</h2>

    <div id="materialxtoy_doc_editor" class="container-fluid border rounded-4">

      <div class="row p-0 align-items-left justify-content-left">

        <!-- Left side document text -->
        <div class="col-sm-6 py-0 px-1" id="xml_editor_column">

          <nav style="font-size: 12px" class="navbar navbar-expand navbar-dark bg-dark">
            <div class="rounded-2 bg-gradient container-fluid">
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nodGraphMenu"
                aria-controls="nodGraphMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="nodGraphMenu">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                  <!---------------------- File ------------------->
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      File
                    </a>
                    <ul class="dropdown-menu">
                      <!-- <li><a class="dropdown-item" id="loadSerialization">JSON Serialization</a></li> -->
                      <!-- <li><div class="dropdown-item" id="loadMaterialXDocumentFromText">MaterialX Text</div></li> -->
                      <li><a style="font-size: 12px" class="dropdown-item" id="clearDocument">Clear</a></li>
                      <li>
                        <div style="font-size: 12px" class="dropdown-item" id="loadMaterialXDocumentFromFile">Load...
                        </div>
                      </li>
                      <hr class="dropdown-divider">
                  </li>
                  <li>
                    <div style="font-size: 12px" class="dropdown-item" id="saveMaterialDocumentToFile">Save...
                    </div>
                  </li>
                </ul>
                </li>

                <!---------------------- Library ------------------->
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" data-bs-auto-close='outside' role="button"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Library
                  </a>
                  <ul id="libraryDropdown" class="dropdown-menu">
                  </ul>
                </li>
                </ul>

                <button id="materialXTextArea_copy" class="btn btn-outline-secondary btn-sm copy-button"
                  data-target="materialXTextArea">
                  <img class="inverted-svg" src="Icons/copy-regular.svg" style="width: 18px;" alt="Copy Icon">
                </button>
                <button id="materialXTextArea_paste" class="btn btn-outline-secondary btn-sm"
                  data-target="materialXTextArea">
                  <img class="inverted-svg" src="Icons/clipboard.svg" style="width: 18px;" alt="Copy Icon">
                </button>

                <form class="d-flex" onsubmit="return false;">
                  <input class="form-control font-sm me-2" type="search" id="search_text" placeholder="Search"
                    style="font-size: 11px" aria-label="Search">
                  <button id="search_forward" class="btn btn-sm btn-outline-secondary">
                    <i style="width: 12px;" class="bi bi-sm bi-arrow-right"></i></button>
                  <button id="search_backward" class="btn btn-sm btn-outline-secondary">
                    <i style="width: 12px;" class="bi bi-sm bi-arrow-left"></i></button>
                </form>

              </div>
            </div>
          </nav>

          <textarea class="form-control form-control-sm overflow-auto" data-bs-theme="dark" id="materialXTextArea"
            rows="100" placeholder="Loaded MaterialX document will be displayed here"></textarea><br>
        </div>

        <!-- Right side render -->
        <div id="viewer_propertypanel_column" class="col p-2">

          <!-- Viewer Panel -->
          <div class="container g-0 px-0">
            <div class="bg-gradient row g-0 align-items-left py-1 ps-1">
              <div class="col">
                <button style="font-size: 14px" class="btn btn-sm">
                  Viewer
                </button>
                <button class="btn btn-sm btn-outline-secondary shadow-sm" disabled id="renderButton">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white"
                    class="bi bi-arrow-clockwise" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z" />
                    <path
                      d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466" />
                  </svg>
                </button>
                <button class="btn btn-sm btn-outline-secondary shadow-sm" id="resetCamera">
                  <img src='./Icons/center_w.svg' style="height: 16px;" alt="Reset Camera">
                </button>
                <button id="turntableEnabled" class="btn btn-sm btn-outline-secondary">
                  <img src='./Icons/play_white.svg' style="height: 16px;" alt="Toggle Turntable">
                </button>
                <button id="toggleBackgroundTexture" class="btn btn-sm btn-outline-secondary">
                  <img src='./Icons/show.svg' style="height: 16px;" alt="Toggle Turntable">
                </button>
                <button id="snapshot3D" class="btn btn-sm btn-outline-secondary">
                  <img src='./Icons/snapshot_white.svg' style="height: 16px;" alt="Toggle Turntable">
                </button>

                <select class="form-select-sm" style="font-size: 11px;" id="renderableItem">
                </select>

                <!-- <label for="loadGeometry">Geometry:</label> -->
                <select class="form-select-sm" style="font-size: 11px" id="loadGeometry">
                  <option value="teapot">Teapot</option>
                  <option value="shaderball">Shader Ball</option>
                  <option value="sphere">Sphere</option>
                  <option value="plane">Plane</option>
                  <option value="cube">Cube</option>
                  <option value="cylinder">Cylinder</option>
                  <option value="twist">Twist</option>
                  <option value="boombox">BoomBox</option>
                  <option value="_loadFromFile_">Custom...</option>
                </select>
              </div>
            </div>

            <div class="row px-0 py-0">
              <div class="col" id="colContainer">
                <div class="canvas-container" id="canvasContainer">
                  <canvas id="webglcanvas" tabindex=1 class="rounded-4" style="outline: none"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row py-0 px-0">
        <textarea id="statusLine" style="font-size: 10px" class="form-control form-control-sm overflow-auto" disabled
          rows="1"></textarea>
      </div>
    </div>

    <!-- Button to generate shader -->
    <hr>
    <div style="font-size: 12px" class="container-fluid m-0 p-2">
      <div class="row flex-wrap">
        <div class="col-sm-6">
          <button style="font-size: 12px" class="btn btn-sm btn-primary shadow-sm" disabled id="generateShaderButton">
            Generate Shader</button>
        </div>
        <div class="col">
          <label for="shaderLanguage">Language:</label>
          <select id="shaderLanguage">
            <option value="0">ESSL</option>
            <option value="1">OSL</option>
            <option value="2">GLSL</option>
            <option value="3">Metal</option>
            <option value="4">Vulkan</option>
            <option value="5">MDL</option>
          </select>
          <label for="shaderInterface">Interface</label>
          <select id="shaderInterface">
            <option value="0">Reduced</option>
            <option value="1" selected>Complete</option>
          </select>
          <label for="hwSrgbEncodeOutput">sRGB Out</label>
          <input type="checkbox" value="" id="hwSrgbEncodeOutput">
        </div>
      </div>
      <div class="row flex-nowrap">
        <div class="col p-2">
          <label for="materialXShader"><b>Pixel Shader</b></label>
          <button id="pixshaderButton" class="btn btn-sm copy-button" data-target="materialXShader">
            <img class="inverted-svg" src="Icons/copy-regular.svg" style="width: 18px;" alt="Copy Icon">
          </button>
          <textarea class="overflow-auto form-control form-control-sm" data-bs-theme="dark" id="materialXShader"
            rows="12" style="width: 100%; border:solid thin lightskyblue;"
            placeholder="Generated shader code will be displayed here"></textarea><br>
        </div>
        <div class="col p-2">
          <label for="materialXShaderVS"><b>Vertex Shader</b></label>
          <button id="vertexshaderButton" class="btn btn-sm copy-button" data-target="materialXShaderVS">
            <img class="inverted-svg" src="Icons/copy-regular.svg" style="width: 18px; " alt="Copy Icon">
          </button>
          <textarea class="overflow-auto form-control form-control-sm" data-bs-theme="dark" id="materialXShaderVS"
            rows="12" style="width: 100%; border:solid thin lightskyblue;"
            placeholder="Generated shader code will be displayed here"></textarea><br>
        </div>
      </div>

      <label for="materialXShaderVS"><b>Pixel Shader Uniforms</b></label>
      <div disabled id="materialXShaderUniformCount">Uniform Count: 0, Exposed: 0</div>
      <p></p>
      <div class="container-fluid p-2 py-0" style="border:solid thin lightskyblue; max-height: 300px; overflow-y: auto;">
        <table id="materialXShaderReflect" data-bs-theme="dark"
            class="table table-bordered">
        </table>
      </div>

      <p></p>
      <hr>
      <button style="font-size: 12px" class="btn btn-sm btn-primary shadow-sm" id="saveReflection">Save
        Reflection
        Information</button>
      <a id="reflectionLink" style="display: none;"></a>
    </div>
  </div>

  <script type="text/javascript" src="ui_helpers.js"></script>
  <script type="text/javascript">
    console.log("Load MaterialX");

    let mmx = null;
    let mdoc = null;
    let renderableItems = [];

    let esslgenerator = null;
    let esslgenContext = null;
    let oslgenerator = null;
    let oslgenContext = null;
    let glslgenerator = null;
    let glslgenContext = null;
    let mslgenerator = null;
    let mslgenContext = null;
    let vkgenerator = null;
    let vkgenContext = null;
    let mdlgenerator = null;
    let mdlgenContext = null;
    let stdlib = null;

    function setupGenerators(maindoc) {
      if (esslgenerator != null)
        return;

      esslgenerator = new mmx.EsslShaderGenerator();
      esslgenContext = new mmx.GenContext(esslgenerator);
      stdlib = mmx.loadStandardLibraries(esslgenContext);
      maindoc.importLibrary(stdlib);

      oslgenerator = new mmx.OslShaderGenerator();
      oslgenContext = new mmx.GenContext(oslgenerator);
      mmx.loadStandardLibraries(oslgenContext);

      glslgenerator = new mmx.GlslShaderGenerator();
      glslgenContext = new mmx.GenContext(glslgenerator);
      mmx.loadStandardLibraries(glslgenContext);

      mslgenerator = new mmx.MslShaderGenerator();
      mslgenContext = new mmx.GenContext(mslgenerator);
      mmx.loadStandardLibraries(mslgenContext);

      vkgenerator = new mmx.VkShaderGenerator();
      vkgenContext = new mmx.GenContext(vkgenerator);
      mmx.loadStandardLibraries(vkgenContext);

      mdlgenerator = new mmx.MdlShaderGenerator();
      mdlgenContext = new mmx.GenContext(mdlgenerator);
      mmx.loadStandardLibraries(mdlgenContext);

    }

    function loadMaterialX() {
      return new Promise((resolve, reject) => {
        MaterialX().then((mmtlx) => {
          // Save the MaterialX instance to the global variable
          mmx = mmtlx;

          console.log("MaterialX loaded");

          // Enable the buttons to load MaterialX documents, generate shaders, and render
          document.getElementById('loadMaterialXDocumentFromFile').disabled = false;
          document.getElementById('generateShaderButton').disabled = false;
          document.getElementById('renderButton').disabled = false;

          // Resolve the promise
          resolve();
        }).catch((error) => {
          // Reject the promise if there's an error
          reject(error);
        });
      });
    }

    function loadInitialText(filePath) {
      try {
        fetch(filePath)
          .then(response => response.blob())
          .then(blob => {
            // Now 'blob' contains the binary data of the file
            //console.log(blob);

            // You can use the Blob in your application, for example, in FileReader
            const reader = new FileReader();
            reader.onload = function (e) {
              //console.log('Read file:', e.target.result);
              showDocument(e.target.result, false);
            }
            reader.readAsText(blob);
          })
      } catch (error) {
        console.error('Error loading file %s:' % filePath, error);
      }
    }

    // Call the asynchronous function and then perform additional logic
    loadMaterialX().then(() => {
      // Get URL options. Fallback to defaults if not specified.
      let materialFilename = new URLSearchParams(document.location.search).get("file");
      if (!materialFilename) {
        materialFilename = './Materials/Examples/Custom/gooch_shade.mtlx';
      }
      loadInitialText(materialFilename);

    }).catch((error) => {
      console.error("Error loading MaterialX:", error);
    });

    function loadMaterialXDocumentFromFile() {
      // Open file dialog
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.mtlx';
      input.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          // Get path to file
          let path = URL.createObjectURL(file);
          console.log('Load MaterialX document: ', file.name + ' Path: ' + path, 'File: ', file);
          loadMaterialXDocument(file, file.name);
          toggleRequireUpdateUI(true);
        }
      });

      // Trigger the file dialog
      input.click();
    }

    function searchInText(searchForward = true) {
      // Search in materialX text area
      let searchText = document.getElementById('search_text').value;

      // Assuming `searchText` is the text you're searching for
      // And `myCodeMirror` is your CodeMirror instance
      // Find the position of the searchText in the CodeMirror instance
      let myCodeMirror = editor;



      let cursorPos = myCodeMirror.getCursor();
      let cursorIndex = myCodeMirror.indexFromPos(cursorPos);
      let content = myCodeMirror.getValue();
      let searchIndex = -1;

      if (searchForward) {
        searchIndex = content.indexOf(searchText, cursorIndex);
      } else { // backward
        let adjustedCursorIndex = cursorIndex - 1;
        let contentBeforeCursor = content.substring(0, adjustedCursorIndex);
        searchIndex = contentBeforeCursor.lastIndexOf(searchText);
      }

      if (searchIndex >= 0) {
        //console.log('Search for:', searchText, 'Index:', searchIndex);

        let startPos = myCodeMirror.posFromIndex(searchIndex);
        let endPos = myCodeMirror.posFromIndex(searchIndex + searchText.length);
        myCodeMirror.setSelection(startPos, endPos);
        myCodeMirror.scrollIntoView({ from: startPos, to: endPos });
        myCodeMirror.focus();
      } else {
        console.log("Search text not found.");
      }
      /*
            // Get the current cursor position in the CodeMirror instance
            let cursorPos = myCodeMirror.getCursor();
            // Convert the cursor position to an index
            let cursorIndex = myCodeMirror.indexFromPos(cursorPos);
    
            let content = myCodeMirror.getValue();
            //var searchIndex = content.indexOf(searchText);
            let searchIndex = -1;
       
            if (searchForward) {
              searchIndex = content.indexOf(searchText, cursorIndex);
            } else { // backward
              let contentBeforeCursor = content.substring(0, cursorIndex);
              searchIndex = contentBeforeCursor.lastIndexOf(searchText);
            }
            //content.indexOf(searchText, cursorIndex);
    
            if (searchIndex >= 0) {
              // Convert searchIndex to a CodeMirror position
              var startPos = myCodeMirror.posFromIndex(searchIndex);
              var endPos = myCodeMirror.posFromIndex(searchIndex + searchText.length);
    
              // Set the selection range in the CodeMirror instance
              myCodeMirror.setSelection(startPos, endPos);
    
              // Optionally, you might want to scroll to the selection or focus the editor
              myCodeMirror.scrollIntoView({from: startPos, to: endPos});
              myCodeMirror.focus();
            }
            else
            {
              console.log('Search text not found:', searchText);
            }
          }*/
    }

    // Attach menu handlers
    document.getElementById('loadMaterialXDocumentFromFile').addEventListener('click', () => {
      loadMaterialXDocumentFromFile();
    });
    document.getElementById('clearDocument').addEventListener('click', () => {
      clearMaterialDocument();
    });
    document.getElementById('saveMaterialDocumentToFile').addEventListener('click', () => {
      saveMaterialDocumentToFile();
    });

    document.getElementById('search_forward').addEventListener('click', () => {
      searchInText(true);
    });
    document.getElementById('search_backward').addEventListener('click', () => {
      searchInText(false);
    });

    /* let textArea = document.getElementById('materialXTextArea');
    let searchIndex = textArea.value.indexOf(searchText);
    console.log('Search for:', searchText, 'Index:', searchIndex);
    if (searchIndex >= 0) {
      textArea.setSelectionRange(searchIndex, searchIndex + searchText.length);
    }
  });*/

    const ALL_GEOMETRY_SPECIFIER = "*";
    const NO_GEOMETRY_SPECIFIER = "";

    function findRenderableElements(mdoc) {
      const materialNodes = mdoc.getMaterialNodes();
      let shaderList = [];
      let foundRenderable = false;
      let renderableItems = [];

      for (let i = 0; i < materialNodes.length; ++i) {
        let materialNode = materialNodes[i];
        if (materialNode) {
          //console.log('Scan material: ', materialNode.getNamePath());
          let shaderNodes = mmx.getShaderNodes(materialNode)
          if (shaderNodes.length > 0) {
            let shaderNodePath = shaderNodes[0].getNamePath()
            if (!shaderList.includes(shaderNodePath)) {
              let assignment = NO_GEOMETRY_SPECIFIER;
              if (foundRenderable == false) {
                assignment = ALL_GEOMETRY_SPECIFIER;
                foundRenderable = true;
              }
              //console.log('-- add shader: ', shaderNodePath);
              shaderList.push(shaderNodePath);
              renderableItems.push(shaderNodePath);
            }
          }
        }
      }
      const nodeGraphs = mdoc.getNodeGraphs();
      for (let i = 0; i < nodeGraphs.length; ++i) {
        let nodeGraph = nodeGraphs[i];
        if (nodeGraph) {
          if (nodeGraph.hasAttribute('nodedef') || nodeGraph.hasSourceUri()) {
            continue;
          }
          // Skip any nodegraph that is connected to something downstream
          if (nodeGraph.getDownstreamPorts().length > 0) {
            continue
          }
          let outputs = nodeGraph.getOutputs();
          for (let j = 0; j < outputs.length; ++j) {
            let output = outputs[j];
            {
              let assignment = NO_GEOMETRY_SPECIFIER;
              if (foundRenderable == false) {
                assignment = ALL_GEOMETRY_SPECIFIER;
                foundRenderable = true;
              }
              //let newMat = new MaterialAssign(output, assignment, null);
              renderableItems.push(output.getNamePath());
            }
          }
        }
      }
      const outputs = mdoc.getOutputs();
      for (let i = 0; i < outputs.length; ++i) {
        let output = outputs[i];
        if (output) {
          let assignment = NO_GEOMETRY_SPECIFIER;
          if (foundRenderable == false) {
            assignment = ALL_GEOMETRY_SPECIFIER;
            foundRenderable = true;
          }
          renderableItems.push(output.getNamePath());
        }
      }

      /*
      const allNodes = mdoc.getNodes();
      console.log('All Nodes:', allNodes.length, allNodes);
      for (let i = 0; i < allNodes.length; ++i) {
        let node = allNodes[i];
        if (node) {
            if (node.getType() == 'surfaceshader') {
            let shaderNodePath = node.getNamePath()
            if (!shaderList.includes(shaderNodePath)) {
              console.log('========================= Node:', node.getNamePath(), node.getCategory(), node.getType());
              let assignment = NO_GEOMETRY_SPECIFIER;
              if (foundRenderable == false) {
                assignment = ALL_GEOMETRY_SPECIFIER;
                foundRenderable = true;
              }
              shaderList.push(shaderNodePath);
              // Create a dummy surface material
              let surfaceMaterial = mdoc.addChildOfCategory('surfacematerial', shaderNodePath + '_material');
              let sm_input = surfaceMaterial.addInput('surfaceshader', 'surfaceshader');
              sm_input.setValueString(shaderNodePath, 'surfaceshader');
              renderableItems.push(shaderNodePath);
              console.log('Add dummy material:', mmx.prettyPrint(surfaceMaterial));
            }
          }
        }
        
      } */

      //console.log('----------- Renderable Items:', renderableItems);
      // Update selection for renderables
      let renderableItemSelect = document.getElementById('renderableItem');
      if (renderableItemSelect) {
        // See what the curren item is
        let currentSelectionValue = renderableItemSelect.value;

        // Remove any previous children
        while (renderableItemSelect.firstChild) {
          renderableItemSelect.removeChild(renderableItemSelect.firstChild);
        }
        for (let i = 0; i < renderableItems.length; i++) {
          let item = renderableItems[i];
          let option = document.createElement('option');

          if (item == currentSelectionValue) {
            // Need to also update on renderer side.
            //option.selected = true;
          }
          option.value = item;
          let uiItem = item;
          // Truncate the name so it will fit into UI.
          if (uiItem.length > 10)
            uiItem = uiItem.substring(0, 10) + '...';
          option.text = uiItem;
          renderableItemSelect.appendChild(option);
        }
      }

      return renderableItems;
    }

    var editor = null;
    function setupXML(contents) {
      // Initialize CodeMirror for XML syntax highlighting
      if (!editor) {
        materialXTextArea = document.getElementById('materialXTextArea');
        editor = CodeMirror.fromTextArea(materialXTextArea, {
          mode: 'application/xml',
          lineNumbers: true,
          dragDrop: true,
          theme: 'night',
        });

        // Optional: Set an initial value for the textarea
        //const initialXML = ''; //'<?xml version="1.0" encoding="utf-8"?>\r\n<materialx version="1.38" colorspace="lin_rec709">\r\n</materialx>';
        //materialXTextArea.value = initialXML;

        // Update CodeMirror whenever the textarea content changes
        editor.on('change', () => {
          //console.log('Editor Content changed');
          // Copy the content from CodeMirror back to the textarea
          materialXTextArea.value = editor.getValue();
          let lazyUpdate = true;
          if (lazyUpdate) {
            toggleRequireUpdateUI(true);
          }
          else {
            // This is too slow currently.
            showDocument(materialXTextArea.value, true);
          }
        });

        var pasteButton = document.getElementById('materialXTextArea_paste');
        if (pasteButton && addPasteHandler) {
          addPasteHandler(pasteButton, editor);
        }
      }

      editor.setValue(contents);
    }

    function showDocument(fileContents, dirty) {
      (async () => {
        try {
          st = document.getElementById('statusLine');
          st.innerHTML = '';
          st.disabled = true;

          mdoc = mmx.createDocument();

          if (fileContents.length > 0) {
            const readOptions = new mmx.XmlReadOptions();
            readOptions.readXIncludes = false;
            await mmx.readFromXmlString(mdoc, fileContents, '', readOptions);
            //console.log('Read document:', mmx.prettyPrint(mdoc));
          }
          else {
            fileContents = mmx.writeToXmlString(mdoc);
          }

          // Update the text area with the file contents
          let textArea = document.getElementById('materialXTextArea');
          if (textArea.value != fileContents) {
            //console.log('update text area:', textArea);
            textArea.value = fileContents;
            setupXML(fileContents);
          }

          let msg = {}
          // Hack to get standard libraries loaded. The APIs for library handling are not currently
          // exposed....
          let generator = new mmx.EsslShaderGenerator();
          let genContext = new mmx.GenContext(generator);
          let stdlib = mmx.loadStandardLibraries(genContext);
          mdoc.importLibrary(stdlib);
          let valid = mdoc.validate(msg);

          st = document.getElementById('statusLine')
          if (valid) {
            st.innerHTML = 'Document is valid.';
            var event = new InputEvent('blah', { bubbles: true });
            console.log('> Dispatch event:', event);
            textArea.dispatchEvent(event);
            toggleRequireUpdateUI(dirty);
          } else {
            st.innerHTML = 'Document is not valid.\n' + msg.message;
            console.error('> Document is not valid', msg.message);
          }

          renderableItems = findRenderableElements(mdoc); //mdoc.getMaterialNodes();
          if (renderableItems.length == 0) {
            st.innerHTML = st.innerHTML + '\nNo renderable items found';
            console.log('No renderable items found');
          }

        } catch (error) {
          st.innerHTML = error;
          renderableItems = findRenderableElements(mdoc); //mdoc.getMaterialNodes();
          //console.error(error);
        }
      })();
    }

    function clearMaterialDocument() {
      showDocument('', true);
    }

    function saveMaterialDocumentToFile() {
      if (!mmx) {
        console.error("MaterialX is not initialized");
        return;
      }

      // Create document and write text area content to it
      let doc = mmx.createDocument();
      let textArea = document.getElementById('materialXTextArea');
      let fileContents = textArea.value;
      let writeOptions = new mmx.XmlWriteOptions();
      writeOptions.writeXIncludes = false;
      mmx.readFromXmlString(doc, fileContents, '', writeOptions);

      // Open file dialog to save to '.mtlx' file
      let fileName = 'materialx_document.mtlx';
      let blob = new Blob([fileContents], { type: 'application/xml' });
      let a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = fileName;
      a.click();
    }

    function loadMaterialXDocument(file, fileName) {
      if (mmx) {
        // Load the content from the specified file (replace this with actual loading logic)
        console.log("Loading content from file:", file.name);

        const reader = new FileReader();
        reader.readAsText(file, 'UTF-8');

        reader.onload = function (e) {
          // Display the contents of the file in the output div
          let fileContents = e.target.result;
          //console.log(e.target);
          showDocument(fileContents, true);
        }

      } else {
        console.error("MaterialX is not initialized");
      }
    }

    function getUniformValues(shaderStage) {
      //console.log('Get Uniforms for stage:', shaderStage);
      let foundUniforms = {};
      const uniformBlocks = Object.values(shaderStage.getUniformBlocks());


      let uniformsResult = []
      uniformBlocks.forEach(uniforms => {
        if (!uniforms.empty()) {
          for (let i = 0; i < uniforms.size(); ++i) {
            const var1 = uniforms.get(i);
            const value = var1.getValue()?.getValueString();
            const name = var1.getVariable();

            //console.log('Uniform:', name, var1.getType().getName(), value, var1.getPath())
            uniformEntry = [name, var1.getType().getName(), value, var1.getPath()];
            uniformsResult.push(uniformEntry);
            //foundUniforms[name] = { var1.getType().getName(), value, name, uniforms };
          }
        }
      });
      return uniformsResult;
    }

    let cachedReflectionData = ''

    function saveReflection() {
      if (cachedReflectionData) {
        console.log('Save Reflection...');
        let outputJSON = {}
        let jsonString = JSON.stringify(cachedReflectionData, null, 2);
        var blob = new Blob([jsonString], { type: 'application/json' });

        // Create a link element
        var a = document.getElementById('reflectionLink');
        a.href = URL.createObjectURL(blob);
        a.download = cachedReflectionData.element + '_' +
          cachedReflectionData.generate + '_' +
          cachedReflectionData.interface +
          '_reflection.json';
        a.click();
      }
    }
    document.getElementById('saveReflection').addEventListener('click', saveReflection);

    function generateShader() {
      // Add event handler for generate shader
      if (renderableItems.length == 0) {
        console.error('No renderable items found');
        return;
      }
      let renderableItemSelect = document.getElementById('renderableItem');
      // Get selected items content
      let elemPath = renderableItemSelect.value;
      let elem = mdoc.getDescendant(elemPath);
      if (!elem) {
        console.error('Renderable item not found');
        return;
      }

      let pixelSource = ''
      let vertexSource = ''

      setupGenerators(mdoc)

      let generator = esslgenerator;
      let genContext = esslgenContext;
      let shaderLanguage = document.getElementById('shaderLanguage').value;
      if (shaderLanguage == 1) {
        generator = oslgenerator;
        genContext = oslgenContext;
      }
      else if (shaderLanguage == 2) {
        generator = glslgenerator;
        genContext = glslgenContext;
      }
      else if (shaderLanguage == 3) {
        generator = mslgenerator;
        genContext = mslgenContext;
      }
      else if (shaderLanguage == 4) {
        generator = vkgenerator;
        genContext = vkgenContext;
      }
      else if (shaderLanguage == 5) {
        generator = mdlgenerator;
        genContext = mdlgenContext;
      }
      //console.log('-------------- Use Generator for: %s ---------------', generator.getTarget())

      const isTransparent = mmx.isTransparentSurface(elem, generator.getTarget());
      genContext.getOptions().hwTransparency = isTransparent;
      // Always set to complete.
      // Can consider option to set to reduced as the parsing of large numbers of uniforms (e.g. on shading models)
      // can be quite expensive.
      let interface = document.getElementById('shaderInterface').value;
      let interfaceString = 'Reduced';
      if (interface == 0) {
        genContext.getOptions().shaderInterfaceType = mmx.ShaderInterfaceType.SHADER_INTERFACE_REDUCED;
      } else {
        interfaceString = 'Complete';
        genContext.getOptions().shaderInterfaceType = mmx.ShaderInterfaceType.SHADER_INTERFACE_COMPLETE;
      }

      // Get the sRGB encode option
      hwSrgbEncodeOutput = document.getElementById('hwSrgbEncodeOutput').checked;
      genContext.getOptions().hwSrgbEncodeOutput = hwSrgbEncodeOutput;

      console.log('Generate Shader: ', elemPath, elem, genContext);
      let shader = null;
      try {
        shader = generator.generate(mmx.createValidName(elemPath), elem, genContext);
      } catch (error) {
        pixelSource = 'Error generating shader:' + error;
      }
      let noVertexShader = (shaderLanguage == 1 || shaderLanguage == 5)

      if (shader) {
        if (!noVertexShader)
          vertexSource = shader.getSourceCode("vertex");
        pixelSource = shader.getSourceCode("pixel");
      }

      // Add extra information if Vulkan as the target of GLSL
      // is not unique
      let generatorTarget = generator.getTarget();
      if (generator == vkgenerator)
      {
        generatorTarget += " (Vulkan)";
      }

      let graphTextArea = document.getElementById('materialXShader');
      pixelSource =
        '//\n// Pixel shader for: ' + elemPath + ' \n' +
        '// Generator Target: ' + generatorTarget + '\n' +
        '// Shader interface: ' + interfaceString + '\n' +
        '// Encode sRGB output: ' + hwSrgbEncodeOutput + '\n' +
        '//\n' + pixelSource;
      graphTextArea.value = pixelSource;

      let vsArea = document.getElementById('materialXShaderVS');
      if (!noVertexShader)
        vsArea.value =
          '//\n// Vertex shader for: ' + elemPath + ' \n' +
          '// Generator Target: ' + generatorTarget + '\n' +
          '// Shader interface: ' + interfaceString + '\n' +
          '//\n' + vertexSource;
      else
        vsArea.value = '// No vertex shader for language';

      //let uniforms = getUniformValues(shader.getStage('vertex'));
      //console.log('Vertex Uniforms:', uniforms);
      if (!shader.getStage('pixel')) {
        console.warn('No pixel shader stage found');
      }
      else {
        let pixelUniforms = getUniformValues(shader.getStage('pixel'));
        cachedReflectionData =
        {
          "element_path": elemPath,
          "shader_generator": generatorTarget,
          "generator_interface": interfaceString.toLowerCase(),
          "srgb_out_injection": hwSrgbEncodeOutput,
          "shader_uniforms": pixelUniforms
        };
        if (vertexSource == '')
          cachedReflectionData.vertex = 'None';
        else
          cachedReflectionData.vertex = vertexSource;
        if (pixelSource == '')
          cachedReflectionData.pixel = 'None';
        else
          cachedReflectionData.pixel = pixelSource;

        let reflectionArea = document.getElementById('materialXShaderReflect');
        // remove any previous children
        while (reflectionArea.firstChild) {
          reflectionArea.removeChild(reflectionArea.firstChild);
        }

        // Add header:
        let headers = ['Uniform', 'Type', 'Value', 'Path'];
        let headerRow = document.createElement('tr');
        headers.forEach(function (title) {
          var headerCell = document.createElement("th");
          headerCell.textContent = title;
          headerRow.appendChild(headerCell);
        });
        reflectionArea.appendChild(headerRow);

        // Add content
        let exposedCount = 0;
        for (let i = 0; i < pixelUniforms.length; i++) {
          let uniform = pixelUniforms[i];
          let row = document.createElement('tr');
          for (let j = 0; j < uniform.length; j++) {
            if (j == 3 && uniform[j].length > 0) {
              exposedCount++;
            }
            let cell = document.createElement('td');
            cell.textContent = uniform[j];
            row.appendChild(cell);
          }
          reflectionArea.appendChild(row);
        }
        //let jsonResult = JSON.stringify(cachedReflectionData, null, 2);
        //console.log('Reflection Data:', jsonResult);

      let reflectCount = document.getElementById('materialXShaderUniformCount');
        reflectCount.textContent = 'Uniform Count:' + String(pixelUniforms.length) +
        ', Exposed:' + String(exposedCount);
      }
    }

    document.getElementById('generateShaderButton').addEventListener('click',
      generateShader);
    document.getElementById('shaderLanguage').addEventListener('change',
      generateShader);
    document.getElementById('shaderInterface').addEventListener('change',
      generateShader);
    document.getElementById('hwSrgbEncodeOutput').addEventListener('change',
      generateShader);

    function toggleRequireUpdateUI(val = true) {
      let graphtoxml2 = document.getElementById('renderButton');
      if (graphtoxml2) {
        if (val) {
          graphtoxml2.classList.remove('btn-outline-secondary');
          graphtoxml2.classList.add('btn-outline-warning');
        }
        else {
          graphtoxml2.classList.remove('btn-outline-warning');
          graphtoxml2.classList.add('btn-outline-secondary');
        }
      }
    }

    let renderButton = document.getElementById('renderButton');
    if (renderButton) {
      renderButton.addEventListener('click', () => {
        console.log('Update from text area');
        let textArea = document.getElementById('materialXTextArea');
        showDocument(textArea.value, false);
      });
    }

    addCopyHandlers();
    addPasteHandlers();
  </script>
  <script type="module">
    // Build library menu
    import { MxNodeEditorPreferences } from "../../node_editor_preferences.js";
    let preferences = new MxNodeEditorPreferences();
    let sampleFiles = preferences.getExamples();

    function loadLibraryDocument(materialFilename) {
      function loadInitialText(filePath, handler) {
        try {
          fetch(filePath)
            .then(response => response.blob())
            .then(blob => {
              const reader = new FileReader();
              reader.onload = function (e) {
                console.log('Loaded document:', filePath);
                // Update text area
                editor.setValue(e.target.result);
                //editor.loadGraphFromString('mtlx', e.target.result, filePath, 80);
              }
              reader.readAsText(blob);
            })
        } catch (error) {
          console.error('Error loading file %s:' % filePath, error);
        }
      }
      loadInitialText(materialFilename, this);
    }

    /**
     * Create a menu item for the library dropdown
     * @param {String} text - The text to display for the menu item
     * @param {String} filename - The filename to load when the menu item is clicked
     * @returns {HTMLElement} - The menu item element
     */
    function createMenuItem(text, filename) {
      let menuItem = document.createElement('li');
      menuItem.className = 'dropdown-item';
      menuItem.innerText = text;
      menuItem.style.fontSize = '10px';
      menuItem.onclick = function () {
        console.log('Load library file:', filename);
        loadLibraryDocument(filename);
        //MxShadingGraphEditor.theEditor.handler.loadLibraryDocument(MxShadingGraphEditor.theEditor, filename);
        // Collapse the dropdown menu
        let dropdownMenu = document.getElementById('libraryDropdown');
        dropdownMenu.classList.remove('show');
      };
      return menuItem;
    }

    /**
     * Create a submenu for the library dropdown
     * @param {String} title - The title of the submenu
     * @param {Boolean} auto_close - Make the submenu appear if not top level
     * @returns {HTMLElement} - The submenu element
     */
    function createSubMenu(title, auto_close = false) {

      let li = document.createElement('li');
      li.className = "dropend dropdown";
      li.id = title;

      let subMenu = document.createElement('a');
      subMenu.style.fontSize = '10px';
      subMenu.className = "dropdown-item dropdown-toggle";
      subMenu.setAttribute('data-bs-toggle', "dropdown");
      if (auto_close) {
        subMenu.setAttribute('data-bs-auto-close', 'outside');
      }
      subMenu.setAttribute('aria-expanded', 'false');
      subMenu.setAttribute('aria-haspopup', 'true');
      subMenu.innerHTML = title;
      li.appendChild(subMenu);

      return li;
    }

    /**
     * Create the library menu structure
     * @param {Object} sampleFiles - The object containing the library structure
     * @param {HTMLElement} libraryDropdown - The dropdown menu element
     * @returns {void}
     */
    function createLibraryMenu(sampleFiles, libraryDropdown) {
      for (let key in sampleFiles) {
        // Create top level menus
        let li = createSubMenu(key, true);
        libraryDropdown.appendChild(li);

        let value = sampleFiles[key];

        // Add items to the submenu
        if (typeof value === 'string') {
          let value = sampleFiles[key];
          li.appendChild(createMenuItem(key, value));
        }
        else if (typeof value === 'object') {

          let subMenuList = document.createElement('ul');
          subMenuList.className = 'dropdown-menu';
          subMenuList.style.fontSize = '10px';
          subMenuList.id = key;

          for (key in value) {

            // Check if value is a string
            if (typeof value[key] === 'string') {
              subMenuList.appendChild(createMenuItem(key, value[key]));
            }

            else if (typeof value[key] === 'object') {

              // Create sub level menus
              let sli = createSubMenu(key, false);
              subMenuList.appendChild(sli);

              let ssubMenuList = document.createElement('ul');
              ssubMenuList.className = 'dropdown-menu';
              for (let skey in value[key]) {
                ssubMenuList.appendChild(createMenuItem(skey, (value[key])[skey]));
              }
              sli.appendChild(ssubMenuList);
            }
          }

          li.appendChild(subMenuList);
        }

      }
    }

    // Build material library menu UI
    if (sampleFiles && libraryDropdown) {
      createLibraryMenu(sampleFiles, libraryDropdown);
    }

    // Make body dark theme
    document.body.setAttribute('data-bs-theme', 'dark');

  </script>

    </div>
  </section>

    <footer class="bg-dark-subtle footer text-white py-2 pt-2" data-bs-theme="dark">
    <div class="container">
      <ul class="social-icons">
        <button class="btn btn-outline" type="button">
          <a href="https://github.com/kwokcb/MaterialX_Learn" target="_blank"><b class="fa-brands fa-github fa-2x"
              style="color: #ffffff;"></b></a>
        </button>
        <button class="btn btn-outline " type="button">
          <a href="https://www.linkedin.com/in/bernard-kwok/" target="_blank"><b class="fa-brands fa-linkedin-in fa-2x"
              style="color: #0082ca;"></b></a>
        </button>
      </ul>
      <p>
        <a class="bg-dark p-2 right" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0"
                src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
        &copy; 2022-2024 NanMu Consulting.</a>
      </p>      
    </div>
  </footer>

</body>

</html>