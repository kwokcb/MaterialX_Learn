<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7404418VP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-J7404418VP');
  </script>

  <style>
    model-viewer {
      width: 256px;
      height: 256px;
      background-color: #7d7d7d;
    }
  </style>

  <link rel="icon" href="../documents/images/logo3d_icon.png" type="image/x-icon" />
  <!--
  <link rel="icon" href="../documents/images/logo3d_2_small.png" type="image/x-icon" />
  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.0/css/all.css">

  <link rel="stylesheet" href="../documents/css/style.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  

  <title>MaterialX Learn</title>
  <link rel="icon" type="images" href="../documents/images/logo3d_icon.png" class="img-fluid">

</head>

<body>
      <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
    <script> mermaid.initialize({ startOnLoad: false, theme: document.body.classList.contains("vscode-dark") || document.body.classList.contains("vscode-high-contras") ? "dark" : "base", themeVariables: { primaryColor: "#F1F1F1", primaryBorderColor: "#000000", lineColor: "#000000", secondaryColor: "#EFEFFF", tertiaryColor: "#EEEEEE" } }); </script>

    <script src="../documents/js/ui_helpers.js"> </script>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
                ? 'dark'
                : 'default'
        });
    </script>

    <!-- Navigation  -->
    <nav class="navbar sticky-top navbar-expand-lg bg-dark-subtle" data-bs-theme="dark">
        <div class="container-md container-fluid">
            <a class="navbar-brand" href="../index.html">
                <h5><img src="../documents/images/logo3d_2_small.png" alt="MaterialX Learn"
                        class="rounded d-inline-block align-text-center" width="50px">
                    MaterialX Learn</h5>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainMenuContent"
                aria-controls="mainMenuContent" aria-expanded="false" aria-label="Toggle top menu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainMenuContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link" href="../index.html" role="button">
                            Home
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Learn
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="../documents/nodes_and_nodegraphs.html">
                                    Nodes and Graphs
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/node_definitions.html">
                                    Node Definitions
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/documents.html">
                                    Documents
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                            data-bs-auto-close="outside">Reference</a>
                        <ul class="dropdown-menu shadow">
                            <li><a class="dropdown-item"
                                    href="../documents/definitions/definitions_by_group.html">Library
                                    (By Group)</a></li>
                            <li><a class="dropdown-item"
                                    href="../documents/definitions/all_definitions.html">Library
                                    (All)</a></li>
                            <li><a class="dropdown-item"
                                    href="../documents/definitions/library_glossary.html">Library
                                    Glossary</a></li>
                            <li><a class="dropdown-item" href="https://materialx.org/docs/api/annotated.html"
                                    target="_blank"><img src="../documents/images/MaterialXLogo_200x155.png"
                                        style="width:20px"> C++ API</a></li>

                            <li class="dropend">
                                <a href="#" class="dropdown-item dropdown-toggle" data-bs-toggle="dropdown">Library
                                    Revisions</a>
                                <ul class="dropdown-menu shadow">
                                    <li><a class="dropdown-item" href="../documents/mtlx_1388_vs_1389.html">
                                            1.38.8 vs 1.38.9
                                            (current)</a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1387_vs_1388.html">
                                            1.38.7 vs 1.38.8
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1386_vs_1387.html">
                                            1.38.6 vs 1.38.7
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1385_vs_1386.html">
                                            1.38.5 vs 1.38.6
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1384_vs_1385.html">
                                            1.38.4 vs 1.38.5
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1383_vs_1384.html">
                                            1.38.3 vs 1.38.4
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1382_vs_1383.html">
                                            1.38.2 vs 1.38.3
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1381_vs_1382.html">
                                            1.38.1 vs 1.38.2
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_1380_vs_1381.html">
                                            1.38.0 vs 1.38.1
                                        </a></li>
                                    <li><a class="dropdown-item" href="../documents/mtlx_138_vs_1389.html"> 1.38.0
                                            vs 1.38.9
                                            (current)</a></li>
                                </ul>
                            </li>

                            <div class="dropdown-divider"></div>
                            <li>
                                <a class="dropdown-item" href="../documents/using_library.html">
                                    <img src="../documents/images/info-circle.svg"> Library User Guide
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Utilities</a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="../documents/gltfViewer.html">
                                    glTF Model Viewer
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/mermaidChecker.html">
                                    Graph Visualizer
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../javascript/mtlx_js_utilities.html">
                                  Graph Generator
                                </a>
                            </li>
                            <li>
                            <a class="dropdown-item" href="../javascript/viewer/dist/index_out.html">
                                Shader Preview
                            </a>
                            </li>                            
                            <li>
                            <a class="dropdown-item" href="../documents/mtlx_utilities.html">
                                Python Utilities
                            </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Develop</a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="../documents/python_MaterialX.html">
                                    Notebooks
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/jupyter_example.html">
                                    Examples
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/hosting.html">
                                    Hosting
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Workflows</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="../documents/workflow_usd.html">USD and
                                    MaterialX</a></li>
                            <li><a class="dropdown-item" href="../documents/workflow_gltf.html">glTF and
                                    MaterialX</a></li>
                            <li><a class="dropdown-item" href="../documents/workflow_ocio.html">OCIO and
                                    MaterialX</a></li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Design</a>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="../documents/design.html">
                                    UX Design
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="../documents/implementation.html">
                                    Implementation
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../documents/about.html" role="button">
                            About
                        </a>
                    </li>
                    <!--INDEX_ITEM-->
                </ul>
            </div>
        </div>
    </nav>

  <!-- Section Information -->
  <section class="py-0 px-0 g-0">
    <div class="container-fluid p-4">
      <div class="container-fluid p-0">
  <div class="row flex-nowrap">
    <div class="col-12 p-0 pt-2 pl-2">
      <div class="card border shadow border mb-4">
        <div class="card-body">


          <h3>Mermaid Graph Visualizer</h3>

          <b>Usage</b>
          <ul>
            <li>
              Enter, paste or load Mermaid text into the input text area to see the results below <sup>(*)</sup>
            </li>
            <li>
              If the text is valid then a graph will be displayed.
            </li>
            <li>
              The graph can be saved to SVG format using the 'Save SVG' button.
            </li>
          </ul>
          <sup>(*) Note: The graphs for standard library definitions can be found
            <a href="https://github.com/kwokcb/MaterialX_Learn/tree/main/documents/images/graphio">here.</a>
          </sup>

          <div class="row flex-nowrap">

            <div class="col-sm-12 p-2">

              <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
              <script>
                mermaid.initialize({
                  startOnLoad: false,
                  theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
                    ? 'dark'
                    : 'base',
                  themeVariables: {
                    'primaryColor': '#F1F1F1',
                    'primaryBorderColor': '#000000',
                    'lineColor': '#000000',
                    'secondaryColor': '#EEEEFF',
                    'tertiaryColor': '#EEEEEE'
                  }
                });
              </script>
              <textarea class="mermaid_input form-control form-control-sm"
                style="width:95%; height:200px; font-size: 14px;" placeholder="Enter mermaid text here..."></textarea>
              <p>
                <label class="col-form-label">
                  <input id="loadgraph" type="file" accept=".md" style="display:none" />
                  <button id="" class="btn btn-outline-primary shadow-sm" style="pointer-events: none;">Load
                    Graph</button>
                </label>
              </p>
              <br>

              <div class="mermaid_output rounded bg-light" style="width:95%; border:solid thin lightskyblue">
                <!-- An svg element called "graphout" will be inserted on render -->
              </div>
              <p></p>
              <div class="col-sm2 flex">
                <button id="saveSVG" class="btn btn-outline-primary shadow-sm">Save SVG</button>
                <button id="resetSVGView" class="btn btn-outline-primary shadow-sm">Reset View</button>
                <!-- <button id="savePNG" class="btn btn-outline-secondary shadow">Save PNG</button> -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let prevSVG = ''
  let originalViewBox = ''

  function loadGraph() {
    let input = document.getElementById('loadgraph');
    let file = input.files[0];
    if (!file) {
      console.log("Nothing to read");
      return;
    }
    let fr = new FileReader();
    fr.onload = setGraph;
    fr.readAsText(file);
  }

  function setGraph(e) {
    console.log('read lines')
    let lines = e.target.result;
    lines = lines.replace('```mermaid', '')
    lines = lines.replace('```', '')
    var inputArea = document.querySelector(".mermaid_input");
    inputArea.value = lines;
    prevSVG = ''
    renderMermaid();
  }

  let loadButton = document.getElementById('loadgraph');
  if (loadButton) {
    loadButton.addEventListener('change', loadGraph, false);
  }

  function savePNG(elem, name) {
    // SvG to image
    svgBlob = createSvgBlob(elem);
    const img = new Image();
    var svgUrl = URL.createObjectURL(svgBlob);
    img.src = svgUrl;

    // Render SVG to canvas
    var canvas = document.createElement("canvas");
    var bbox = elem.getBBox();
    canvas.width = bbox.width;
    canvas.height = bbox.height;

    const context = canvas.getContext('2d');
    context.drawImage(img, 0, 0, bbox.width, bbox.height);

    // Save to disk
    const url = canvas.toDataURL('image/png');
    saveURL(url, name);
  }

  function saveURL(url, name) {
    var downloadLink = document.createElement("a");
    downloadLink.href = url;
    downloadLink.download = name;
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
  }

  function createSvgBlob(elem) {
    elem.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    var svgData = elem.outerHTML;
    var preface = '<?xml version="1.0" standalone="no"?>\r\n';
    var svgBlob = new Blob([preface, svgData], { type: "image/svg+xml;charset=utf-8" });
    return svgBlob;
  }

  function resetSvgView(elem) {
    if (elem && originalViewBox) {
      currentViewBox = elem.getAttribute('viewBox');
      elem.setAttribute('viewBox', originalViewBox);
    }
    return currentViewBox;
  }

  function saveSvg(elem, name) {
    // Restore original viewBox before saving
    currentViewBox = resetSvgView(elem);

    svgBlob = createSvgBlob(elem);

    // Save to disk
    var url = URL.createObjectURL(svgBlob);
    saveURL(url, name);

    // Restore current viewBox
    if (originalViewBox) {
      elem.setAttribute('viewBox', currentViewBox);
    }
  }

  function renderMermaid() {
    const output = document.querySelector(".mermaid_output");
    const code = document.querySelector(".mermaid_input").value.trim();

    let newSVG = ''
    let generateDiagram = function (code) {
      newSVG = code;
    };

    if (code.length == 0) {
      prevSVG = ''
      output.innerHTML = ''
    }
    if (code) {
      let generated = true;
      prevSVG = output.innerHTML;
      try {
        mermaid.render("graphout", code, generateDiagram)
      } catch (error) {
        generated = false
      }

      if (generated) {
        output.innerHTML = newSVG;
        prevSVG = newSVG;

        var svgContainer = document.querySelector(".mermaid_output");
        var svgContent = document.getElementById('graphout');
        originalViewBox = svgContent.getAttribute('viewBox');
        setUpInteraction(svgContainer, svgContent)
      }
      else {
        // Clear this out so that we don't get the default Mermaid error SVG
        graphout = document.getElementById('graphout');
        if (graphout) {
          graphout.innerHTML = '';
        }
        output.innerHTML = 'Invalid Mermaid text entered. Failed to generate graph.';
      }
    }
  }

  renderButton = document.getElementById("rendergraph")
  if (renderButton) {
    renderButton.addEventListener("click", (e) => {
      renderMermaid()
    });
  }

  inputArea = document.querySelector(".mermaid_input");
  if (inputArea) {
    inputArea.addEventListener('keyup', (event) => {
      renderMermaid();
    })
  }

  // Review view of svg element
  document.getElementById("resetSVGView").addEventListener("click", (e) => {
    var svgContent = document.getElementById('graphout');
    if (svgContent) {
      resetSvgView(svgContent);
    }
  });

  // Save svg element to file
  document.getElementById("saveSVG").addEventListener("click", (e) => {
    var svgContent = document.getElementById('graphout');
    if (svgContent) {
      saveSvg(svgContent, "graph.svg");
    }
  });

  // Save svg element to file as png
  saveElem = document.getElementById("savePNG");
  if (saveElem) {
    saveElem.addEventListener("click", (e) => {
      const element = document.getElementById("graphout");
      if (element) {
        savePNG(element, "graph.png");
      }
    });
  }

  // Interaction for SVG display area
  function setUpInteraction(svgContainer, svgContent) {

    var state = {
      isPanning: false,
      startCoords: { x: 0, y: 0 },
      startViewBox: null
    };

    // Clear or set the style here. Clear max width so that the SVG can be scaled
    // to fit the container.
    style = svgContent.getAttribute('style')
    //svgContent.setAttribute('style', 'max-width:2048px;')
    svgContent.setAttribute('style', '')

    // Handle start of panning
    function handleMouseDown(event) {
      if (event.button !== 0)
        return;

      event.preventDefault();
      state.isPanning = true;
      state.startCoords.x = event.clientX;
      state.startCoords.y = event.clientY;
      state.startViewBox = svgContent.getAttribute('viewBox');
    }

    // Handle panning
    function handleMouseMove(event) {
      if (!state.isPanning)
        return;

      event.preventDefault();
      var dx = event.clientX - state.startCoords.x;
      var dy = event.clientY - state.startCoords.y;
      var viewBox = state.startViewBox.split(' ');

      viewBox[0] -= dx;
      viewBox[1] -= dy;

      svgContent.setAttribute('viewBox', viewBox.join(' '));
    }

    // Handle stop of panning
    function handleMouseUp(event) {
      if (event.button !== 0)
        return;

      event.preventDefault();
      state.isPanning = false;
    }

    // Handle zooming
    function handleWheel(event) {
      event.preventDefault();

      var delta = Math.max(-1, Math.min(1, (event.deltaY || -event.detail)));
      var viewBox = svgContent.getAttribute('viewBox').split(' ');

      var scaleFactor = delta > 0 ? 1.1 : 0.9;

      var containerWidth = svgContainer.offsetWidth;
      var containerHeight = svgContainer.offsetHeight;

      var center = {
        x: containerWidth / 2,
        y: containerHeight / 2
      };

      var oldWidth = parseFloat(viewBox[2]);
      var oldHeight = parseFloat(viewBox[3]);
      var newWidth = oldWidth / scaleFactor;
      var newHeight = oldHeight / scaleFactor;

      var deltaX = (oldWidth - newWidth) * (center.x / containerWidth);
      var deltaY = (oldHeight - newHeight) * (center.y / containerHeight);

      var newX = parseFloat(viewBox[0]) + deltaX;
      var newY = parseFloat(viewBox[1]) + deltaY;

      viewBox[0] = newX;
      viewBox[1] = newY;
      viewBox[2] = newWidth;
      viewBox[3] = newHeight;

      svgContent.setAttribute('viewBox', viewBox.join(' '));
    }

    // Set up event handling
    svgContainer.addEventListener('mousedown', handleMouseDown);
    svgContainer.addEventListener('mousemove', handleMouseMove);
    svgContainer.addEventListener('mouseup', handleMouseUp);
    svgContainer.addEventListener('mouseleave', handleMouseUp);
    svgContainer.addEventListener('wheel', handleWheel);
  };
</script>

    </div>
  </section>

    <footer class="bg-dark-subtle footer text-white py-2 pt-2" data-bs-theme="dark">
    <div class="container">
      <ul class="social-icons">
        <button class="btn btn-outline" type="button">
          <a href="https://github.com/kwokcb/MaterialX_Learn" target="_blank"><i class="fab fa-github fa-2x"
              style="color: #ffffff;"></i></a>
        </button>
        <button class="btn btn-outline " type="button">
          <a href="https://www.linkedin.com/in/bernard-kwok/" target="_blank"><i class="fab fa-linkedin-in fa-2x"
              style="color: #0082ca;"></i></a>
        </button>
      </ul>
      <p>&copy; 2022-2024 NanMu Consulting.</p>
    </div>
  </footer>

</body>

</html>