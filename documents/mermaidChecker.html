<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Authors: Bernard Kwok and Matthew Kwok. Resource site for the
  Academy Software Foundation MaterialX -- an open source industry standard for 3D / Cg materials.
  Resources include interaction with related standards: OpenUSD, Khronos glTF, OpenImageIO.">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7404418VP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-J7404418VP');
  </script>

  <style>
    model-viewer {
      width: 256px;
      height: 256px;
      background-color: #7d7d7d;
    }
    .iframe-container {
      position: relative;
      width: 100%;
      height: 300px;
      overflow: auto;
    }

    .iframe-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>

  <!-- <link rel="icon" href="../documents/images/logo3d_icon.png" type="image/x-icon" /> -->
  <!--
  <link rel="icon" href="../documents/images/logo3d_2_small.png" type="image/x-icon" />
  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.0/css/brands.min.css"> 

  <link rel="stylesheet" href="../documents/css/style.css">

  <!-- 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  -->

  

  <title>MaterialX Elements</title>
  <link rel="icon" type="images" href="../documents/images/logo3d_icon.png" type="image/x-icon" class="img-fluid">

</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
  <script src="../documents/js/ui_helpers.js"></script>
  
  </script>  
   
  <!-- Navigation_Area-->
<nav class="navbar sticky-top navbar-expand-lg bg-dark-subtle" data-bs-theme="dark">
    <div class="container-md container-fluid">
        <a class="navbar-brand" href="../index.html">
            <h5><img src="../documents/images/logo3d_2_small.png" alt="MaterialX Elements"
                    class="rounded d-inline-block align-text-center" width="50px">
                MaterialX Elements</h5>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainMenuContent"
            aria-controls="mainMenuContent" aria-expanded="false" aria-label="Toggle top menu">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mainMenuContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                    <a class="nav-link" href="../index.html" role="button">
                        Home
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Fundamentals
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="../documents/nodes_and_nodegraphs.html">
                                Nodes and Graphs
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="../documents/node_definitions.html">
                                Node Definitions
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="../documents/documents.html">
                                Documents
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="../documents/presentations.html">
                                Presentations and Media
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                        data-bs-auto-close="outside">Reference</a>
                    <ul class="dropdown-menu shadow">
                        <li><a class="dropdown-item"
                                href="../documents/definitions/definitions_by_group.html">Library
                                (By Group)</a></li>
                        <li><a class="dropdown-item"
                                href="../documents/definitions/all_definitions.html">Library
                                (All)</a></li>
                        <li><a class="dropdown-item"
                                href="../documents/definitions/library_glossary.html">Library
                                Glossary</a></li>
                        <li><a class="dropdown-item" href="https://materialx.org/docs/api/annotated.html"
                                target="_blank"><img src="../documents/images/MaterialXLogo_200x155.png"
                                    style="width:20px"> C++ API</a></li>

                        <li class="dropend">
                            <a href="#" class="dropdown-item dropdown-toggle" data-bs-toggle="dropdown">Library
                                Revisions</a>
                            <ul class="dropdown-menu shadow">
                                <li><a class="dropdown-item" href="../documents/mtlx_1389_vs_1390.html">
                                        1.38.9 vs 1.39.0</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1388_vs_1389.html">
                                        1.38.8 vs 1.38.9</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1387_vs_1388.html">
                                        1.38.7 vs 1.38.8</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1386_vs_1387.html">
                                        1.38.6 vs 1.38.7</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1385_vs_1386.html">
                                        1.38.5 vs 1.38.6</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1384_vs_1385.html">
                                        1.38.4 vs 1.38.5</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1383_vs_1384.html">
                                        1.38.3 vs 1.38.4</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1382_vs_1383.html">
                                        1.38.2 vs 1.38.3</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1381_vs_1382.html">
                                        1.38.1 vs 1.38.2</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1380_vs_1381.html">
                                        1.38.0 vs 1.38.1</a></li>
                                <li><a class="dropdown-item" href="../documents/mtlx_1380_vs_1390.html">
                                        1.38.0 vs 1.39.0</a></li>
                            </ul>
                        </li>

                        <div class="dropdown-divider"></div>
                        <li>
                            <a class="dropdown-item" href="../documents/using_library.html">
                                <img src="../documents/images/info-circle.svg"> Library User Guide
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- 
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Utilities</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../javascript/node_editor/index_out.html">Node Graph Editor</a></li>
                        <li><a class="dropdown-item" href="../javascript/shader_editor/dist/index_out.html">Shader Graph Editor</a></li>
                        <li><a class="dropdown-item" href="../javascript/shader_utilities/dist/index_out.html">Shader Utilities</a></li>
                        <li><a class="dropdown-item" href="../javascript/graphing_utilities.html">Node Graph Utilities</a></li>
                        <li><a class="dropdown-item" href="../documents/mermaidChecker.html">Graph Visualizer</a></li>
                        <li><a class="dropdown-item" href="../documents/gltfViewer.html">glTF Model Viewer</a></li>
                        <li><a class="dropdown-item" href="../documents/mtlx_utilities.html">Python Modules</a></li>
                    </ul>
                </li>
                -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Interactive Learning</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../documents/python_MaterialX.html">Notebooks</a></li>
                        <li><a class="dropdown-item" href="../documents/jupyter_example.html">Examples</a></li>
                        <li><a class="dropdown-item" href="../documents/hosting.html">Hosting</a>
                        </li>
                    </ul>
                </li>

                <!--
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Workflows</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../documents/workflow_usd.html">USD and MaterialX</a></li>
                        <li><a class="dropdown-item" href="../documents/workflow_gltf.html">glTF and MaterialX</a></li>
                        <li><a class="dropdown-item" href="../documents/workflow_ocio.html">OCIO and MaterialX</a></li>
                    </ul>
                </li>
                -->                     

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Design</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../documents/design.html">UX Design</a></li>
                        <li><a class="dropdown-item" href="../documents/property_editor_ui.html">Property Editor UX</a></li>
                        <li><a class="dropdown-item" href="https://guannan-kwok.github.io/assetLibrary/materialx/" target="_blank">Graphic Design</a></li>
                        <li><a class="dropdown-item" href="../documents/implementation.html">Implementation</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../documents/about.html" role="button">
                        About
                    </a>
                </li>
                <!--INDEX_ITEM-->
            </ul>
        </div>
    </div>
</nav>

  <!-- Section Information -->
  <section class="py-0 px-0 g-0">
    <div class="container-fluid p-4">
      <div class="container-fluid p-0">
  <div class="row flex-nowrap">
    <div class="col-12 p-0 pt-2 pl-2">
      <div class="card border shadow border mb-4">
        <div class="card-body">


          <h3><img src="images/mermaid-logo.png" style="width: 36px; height: 36px" alt="Mermaid Logo">
            Mermaid Graph Visualizer</h3>

          <details open>
          <summary>Usage</summary>
          <ul>
            <li>
              Enter, paste or load Mermaid text into the input text area to see the results below.
              A sample graph has been pre-loaded by default. <sup>(*)</sup>
            </li>
            <li>
              If the text is valid then a graph will be displayed. Note that Markdown tags <em>```mermaid</em> and <em>```</em> are
              automatically stripped out.
            </li>
            <li>
              The graph can be saved as an SVG file.
            </li>
          </ul>
          <sup>(*) Notes: The graphs for standard library definitions can be found
            <a href="https://github.com/kwokcb/MaterialX_Learn/tree/main/documents/images/graphio">here.</a>, and
            the graphs for the core MaterialX examples can be found <a
              href="https://github.com/kwokcb/MaterialX_Learn/tree/main/resources/MaterialX/Examples">
              here</a>. </sup>
          </sup>
          </details>

          <div class="row flex-nowrap">

            <div class="col-sm-12 p-2">

              <p>
              <h5>Input
                <input id="loadgraph" type="file" accept=".md" style="display:none" />
                <button id="loadgraphButton" class="btn btn-sm invert-button">
                  <img class="" src="icons/file-earmark-arrow-up.svg" style="width: 24px; height: 24px"
                    alt="Load Icon">
                </button>
                <button id="copy_mermaid_button" class="btn btn-sm copy-button" data-target="mermaid_input">
                  <img class="" src="icons/copy-regular.svg" style="width: 24px; height: 24px" alt="Copy Icon">
                </button>
                <button id="paste_mermaid_button" class="btn btn-sm paste-button" data-target="mermaid_input">
                  <img class="" src="icons/clipboard.svg" style="width: 24px; height: 24px" alt="Paste Icon">
                </button>
              </h5>
              </p>
              <textarea id="mermaid_input" class="mermaid_input form-control form-control-sm"
                style="width:95%; height:200px; font-size: 14px;" placeholder="Enter mermaid text here...">
              </textarea>
              <br>

              <h5>Graph
                <button id="saveSVG" class="btn btn-sm invert-button">
                  <img class="" src="icons/file-earmark-arrow-down.svg" style="width: 24px; height: 24px"
                    alt="Save Icon">
                </button>
                <button id="resetSVGView" class="btn btn-sm invert-button">
                  <img class="" src="icons/camera_reset.svg" style="width: 24px; height: 24px" alt="Reset View">
                </button>
                <!-- <button id="savePNG" class="btn btn-outline-secondary shadow">Save PNG</button> -->
              </h5>

              <div id="mermaid_output" class="mermaid_output rounded" style="width:95%; border:solid thin lightskyblue">
                <!-- An svg element called "mermaid_output_rendered" will be inserted on render -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let prevSVG = ''
    let originalViewBox = ''

    function loadGraph() {
      console.log('loading graph---->')

      const inputE = document.createElement('input');
      inputE.type = 'file';
      inputE.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.readAsText(file, 'UTF-8');

          reader.onload = function (e) {
            setGraph(e);
          }
        }
      });

      // Trigger the file dialog
      inputE.click();
    }

    function setDefaultGraph() {
      const lines = `graph LR;
    NG_ramp4_float_N_mix_float[mix] --> NG_ramp4_float_out([out])
    style NG_ramp4_float_out fill:#0C0, color:#111
    NG_ramp4_float_N_mixtop_float[mix] --".bg"--> NG_ramp4_float_N_mix_float[mix]
    NG_ramp4_float_valuetlINT([valuetl]) ==.bg==> NG_ramp4_float_N_mixtop_float[mix]
    style NG_ramp4_float_valuetlINT fill:#0CF, color:#111
    NG_ramp4_float_valuetrINT([valuetr]) ==.fg==> NG_ramp4_float_N_mixtop_float[mix]
    style NG_ramp4_float_valuetrINT fill:#0CF, color:#111
    NG_ramp4_float_N_s_float[extract] --".mix"--> NG_ramp4_float_N_mixtop_float[mix]
    NG_ramp4_float_N_txclamp_float[clamp] --".in"--> NG_ramp4_float_N_s_float[extract]
    NG_ramp4_float_texcoordINT([texcoord]) ==.in==> NG_ramp4_float_N_txclamp_float[clamp]
    style NG_ramp4_float_texcoordINT fill:#0CF, color:#111
    NG_ramp4_float_N_mixbot_float[mix] --".fg"--> NG_ramp4_float_N_mix_float[mix]
    NG_ramp4_float_valueblINT([valuebl]) ==.bg==> NG_ramp4_float_N_mixbot_float[mix]
    style NG_ramp4_float_valueblINT fill:#0CF, color:#111
    NG_ramp4_float_valuebrINT([valuebr]) ==.fg==> NG_ramp4_float_N_mixbot_float[mix]
    style NG_ramp4_float_valuebrINT fill:#0CF, color:#111
    NG_ramp4_float_N_s_float[extract] --".mix"--> NG_ramp4_float_N_mixbot_float[mix]
    NG_ramp4_float_N_t_float[extract] --".mix"--> NG_ramp4_float_N_mix_float[mix]
    NG_ramp4_float_N_txclamp_float[clamp] --".in"--> NG_ramp4_float_N_t_float[extract] `;

      var inputArea = document.getElementById("mermaid_input");
      inputArea.value = lines;
      console.log('Default graph set')
      renderMermaid();
    }

    function setGraph(e) {
      console.log('read lines')
      let lines = e.target.result;
      lines = lines.replace('```mermaid', '')
      lines = lines.replace('```', '')
      var inputArea = document.getElementById("mermaid_input");
      inputArea.value = lines;
      prevSVG = ''
      renderMermaid();
    }

    let loadButton = document.getElementById('loadgraphButton');
    if (loadButton) {
      console.log('Adding event listener for load graph')
      loadButton.addEventListener('click', loadGraph, false);
    }

    function savePNG(elem, name) {
      // SvG to image
      svgBlob = createSvgBlob(elem);
      const img = new Image();
      var svgUrl = URL.createObjectURL(svgBlob);
      img.src = svgUrl;

      // Render SVG to canvas
      var canvas = document.createElement("canvas");
      var bbox = elem.getBBox();
      canvas.width = bbox.width;
      canvas.height = bbox.height;

      const context = canvas.getContext('2d');
      context.drawImage(img, 0, 0, bbox.width, bbox.height);

      // Save to disk
      const url = canvas.toDataURL('image/png');
      saveURL(url, name);
    }

    function saveURL(url, name) {
      var downloadLink = document.createElement("a");
      downloadLink.href = url;
      downloadLink.download = name;
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
    }

    function createSvgBlob(elem) {
      elem.setAttribute("xmlns", "http://www.w3.org/2000/svg");
      var svgData = elem.outerHTML;
      var preface = '<?xml version="1.0" standalone="no"?>\r\n';
      var svgBlob = new Blob([preface, svgData], { type: "image/svg+xml;charset=utf-8" });
      return svgBlob;
    }

    function resetSvgView(elem) {
      if (elem && originalViewBox) {
        currentViewBox = elem.getAttribute('viewBox');
        console.log('Resetting viewbox to:\n ' + originalViewBox)
        elem.setAttribute('viewBox', originalViewBox);
      }
      return currentViewBox;
    }

    function saveSvg(elem, name) {
      // Restore original viewBox before saving
      currentViewBox = resetSvgView(elem);

      svgBlob = createSvgBlob(elem);

      // Save to disk
      var url = URL.createObjectURL(svgBlob);
      saveURL(url, name);

      // Restore current viewBox
      if (originalViewBox) {
        elem.setAttribute('viewBox', currentViewBox);
      }
    }

    function renderMermaid() {
      const output = document.getElementById("mermaid_output");
      var code = document.getElementById("mermaid_input").value.trim();
      // Strip out any ```mermard or ``` tags
      code = code.replace('```mermaid', '')
      code = code.replace('```', '')

      let newSVG = ''
      let generateDiagram = function (code) {
        newSVG = code;
      };

      if (code.length == 0) {
        prevSVG = ''
        output.innerHTML = ''
      }
      if (code) {
        let generated = true;
        prevSVG = output.innerHTML;
        try {
          mermaid.render("mermaid_output_rendered", code, generateDiagram)
        } catch (error) {
          generated = false
        }

        if (generated) {
          output.innerHTML = newSVG;
          prevSVG = newSVG;
          var svgContent = document.getElementById('mermaid_output_rendered');
          originalViewBox = svgContent.getAttribute('viewBox');
          setUpSVGInteraction('mermaid_output', 'mermaid_output_rendered')
        }
        else {
          // Clear this out so that we don't get the default Mermaid error SVG
          mermaid_output_rendered = document.getElementById('mermaid_output_rendered');
          if (mermaid_output_rendered) {
            mermaid_output_rendered.innerHTML = '';
          }
          output.innerHTML = 'Invalid Mermaid text entered. Failed to generate graph.';
        }
      }
    }

    renderButton = document.getElementById("rendergraph")
    if (renderButton) {
      renderButton.addEventListener("click", (e) => {
        renderMermaid()
      });
    }

    inputArea = document.getElementById("mermaid_input");
    if (inputArea) {
      inputArea.addEventListener('keyup', (event) => {
        renderMermaid();
      })
    }

    // Review view of svg element
    document.getElementById("resetSVGView").addEventListener("click", (e) => {
      var svgContent = document.getElementById('mermaid_output_rendered');
      if (svgContent) {
        resetSvgView(svgContent);
      }
    });

    // Save svg element to file
    document.getElementById("saveSVG").addEventListener("click", (e) => {
      var svgContent = document.getElementById('mermaid_output_rendered');
      if (svgContent) {
        saveSvg(svgContent, "graph.svg");
      }
    });

    // Save svg element to file as png
    saveElem = document.getElementById("savePNG");
    if (saveElem) {
      saveElem.addEventListener("click", (e) => {
        const element = document.getElementById("mermaid_output_rendered");
        if (element) {
          savePNG(element, "graph.png");
        }
      });
    }

    setDefaultGraph();

    addCopyHandlers();
    addPasteHandlers();

  </script>

    </div>
  </section>

    <footer class="bg-dark-subtle footer text-white py-2 pt-2" data-bs-theme="dark">
    <div class="container">
      <ul class="social-icons">
        <button class="btn btn-outline" type="button">
          <a href="https://github.com/kwokcb/MaterialX_Learn" target="_blank"><b class="fa-brands fa-github fa-2x"
              style="color: #ffffff;"></b></a>
        </button>
        <button class="btn btn-outline " type="button">
          <a href="https://www.linkedin.com/in/bernard-kwok/" target="_blank"><b class="fa-brands fa-linkedin-in fa-2x"
              style="color: #0082ca;"></b></a>
        </button>
      </ul>
      <p>
        <a class="bg-dark p-2 right" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0"
                src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
        &copy; 2022-2024 NanMu Consulting.</a>
      </p>      
    </div>
  </footer>

</body>

</html>