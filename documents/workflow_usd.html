<!DOCTYPE>
<html>

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J7404418VP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-J7404418VP');
  </script>

  <title>MaterialX Learn - Workflows </title>
  <link rel="icon" href="./images/logo3d_icon.png" type="image/x-icon" />

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="css/style.css">


  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

</head>

<body class="min-vh-100">
  <script src="js/ui_helpers.js"></script>
  <script src="js/definition_card_helpers.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
  <script> mermaid.initialize({ startOnLoad: true, theme: document.body.classList.contains("vscode-dark") || document.body.classList.contains("vscode-high-contras") ? "dark" : "default" }); </script>

  <!-- Navigation  -->
  <nav class="navbar sticky-top navbar-expand-lg bg-dark-subtle" data-bs-theme="dark">
    <div class="container-md container-fluid">
      <a class="navbar-brand" href="../index.html">
        <h5><img src="images/logo3d_2_small.png" alt="MaterialX Learn" class="rounded d-inline-block align-text-center"
            width="60">
          MaterialX Learn</h5>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainMenuContent"
        aria-controls="mainMenuContent" aria-expanded="false" aria-label="Toggle top menu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="mainMenuContent">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">

          <li class="nav-item dropdown">
            <a class="nav-link" href="../index.html" role="button">
              Home
            </a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Learn
            </a>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item" href="nodes_and_nodegraphs.html">
                  Nodes and Graphs
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="node_definitions.html">
                  Node Definitions
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="documents.html">
                  Documents
                </a>
              </li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
              Reference
            </a>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item" href="definitions/definitions_by_group.html">
                  Library (By Group)
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="definitions/all_definitions.html">
                  Library (All)
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="definitions/library_glossary.html">
                  Library Glossary
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="https://materialx.org/docs/api/annotated.html" target="_blank">
                  <img src="images/MaterialXLogo_200x155.png" style="width:20px"> C++ API
                </a>
              </li>

              <li class="dropend">
                <a href="#" class="dropdown-item dropdown-toggle" data-bs-toggle="dropdown">Library Revisions</a>
                <ul class="dropdown-menu shadow">
                  <li><a class="dropdown-item" href="./mtlx_1388_vs_1389.html"> 1.38.8 vs 1.38.9  (current)</a></li>
                  <li><a class="dropdown-item" href="./mtlx_1387_vs_1388.html"> 1.38.7 vs 1.38.8 </a></li>
                  <li><a class="dropdown-item" href="./mtlx_1386_vs_1387.html"> 1.38.6 vs 1.38.7 </a></li>
                  <li><a class="dropdown-item" href="./mtlx_1385_vs_1386.html"> 1.38.5 vs 1.38.6 </a></li>
                  <li><a class="dropdown-item" href="./mtlx_1384_vs_1385.html"> 1.38.4 vs 1.38.5 </a></li>
                  <li><a class="dropdown-item" href="./mtlx_1383_vs_1384.html"> 1.38.3 vs 1.38.4 </a></li>
                  <li><a class="dropdown-item" href="./mtlx_1382_vs_1383.html"> 1.38.2 vs 1.38.3 </a></li>
                  <li><a class="dropdown-item" href="./mtlx_1381_vs_1382.html"> 1.38.1 vs 1.38.2 </a></li>
                  <li><a class="dropdown-item" href="./mtlx_1380_vs_1381.html"> 1.38.0 vs 1.38.1 </a></li>
                  <li><a class="dropdown-item" href="./mtlx_138_vs_1389.html"> 1.38.0 vs 1.38.9   (current)</a></li>
                </ul>
              </li> 

              <div class="dropdown-divider"></div>              
              <li>
                <a class="dropdown-item" href="using_library.html">
                  <img src="images/info-circle.svg"> Library User Guide
                </a>
              </li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">Utilities</a>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item" href="gltfViewer.html">
                  glTF ModelViewer
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="mermaidChecker.html">
                  Graph Visualizer
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="mtlx_utilities.html">
                  Python Utilities
                </a>
              </li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">Develop</a>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item" href="python_MaterialX.html">
                  Tutorials
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="jupyter_example.html">
                  Examples
                </a>
              </li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">Workflows</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="workflow_usd.html">USD and MaterialX</a></li>
              <li><a class="dropdown-item" href="workflow_gltf.html">glTF and MaterialX</a></li>
              <li><a class="dropdown-item" href="workflow_ocio.html">OCIO and MaterialX</a></li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">Design</a>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item" href="design.html">
                  UX Design
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="implementation.html">
                  Implementation
                </a>
              </li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link" href="about.html" role="button">
              About
            </a>
          </li>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container-fluid p-4">
    <div class="row flex-nowrap">
      <div class="col-12 p-0 pt-2 pl-2">
        <div class="card border-secondary shadow border mb-4">
          <div class="card-body">

            <h2 class="shadow border">MaterialX and Usd</h2>

            <img src="images/usd_materialx_interop.png" width="40%">
            <p>The <a href="../pymaterialx/mtlx_definitions_libraries_notebook.html">Usd / MaterialX notebook</a>
              examines the
              interoperability of material / shader graphs between <code>Usd</code> and <code>MaterialX</code>.</p>
            <p>Observations are summarized below.</p>

            <h3>Hierarchy</h3>
            <p>Currently Usd can support arbitrary nesting of graphs. The MaterialX specification also denotes this
              support but this has not been implemented at the time of writing.</p>
            <p>Usd will "flatten" nested graphs to a single level, but this
              functionally does not seem to be exposed via a public API.</p>
            <p>For example the following graphs nodegraph "childNG" has to be placed under the nodegraph "parentNG"
              to be supported in MaterialX.
              <img src="images/nested_nodegraphs.png" width="70%">
            </p>
            <p>It is possible to "flatten" graphs within MaterialX, but no such
              utility / API is provided by default.</p>
            <p>In Usd, for encapsulation, shader graphs are children of a Usd material with reuse via referencing. In
              MaterialX materials are not parents of the graphs they reference. No child hierarchy / grouping
              is enforced. (For more detailed information see the <a href="#materials">Materials</a> section) </p>
            <p><em>One proposal would be to 
              <a href="https://github.com/AcademySoftwareFoundation/MaterialX/issues/1272">support MaterialX node graph
                  hierarchies</a></em>. Related to this is how a "top" or document level
              graphs (which is not contained in a MaterialX nodegraph) behave.
              Basically MaterialX documents are "graph elements" as
              are MaterialX nodegraphs but are inconsistent from nodegraphs in that output ports are treated as AOVs and
              input ports are not allowed.</p>

            <h3>Paths and Connections</h3>
            <ul>
              <li>Usd specifies explicit output ports on nodes and graphs. MaterialX only does this for nodegraphs,
                requiring complex logic
                to discover and extract node output information.</li>
              <li>There is no uniform nor formal connection "API" in MaterialX as with Usd. This could be added to
                MaterialX to mask out the
                complexities due to the next point:</li>
              <li>There is no uniform syntax for specifying connections between
                ports and nodes in a MaterialX graph. Variants exists for connections between:</li>
                <ul>
              <li>requirement to extract various meta-data attributes to compose a path.</li>
              <li>input and output ports for nodes versus nodegraphs </li>
              <li>nodegraph (interface) inputs / outputs vs node inputs and outputs. </li>
              <li>
                Implicit channel extraction via additional meta-data attributes which does not exist in Usd. 
              </li>
            </ul>
              <li>
                <p>MaterialX has no concept of absolute vs relative path notation to specify port paths. (This differs
                  from geometric dag paths used for material assignment)</p>
              </li>
            </ul>
            <p>This contrasts with Usd which simply uses absolute paths syntax for all connections (e.g. '/a/b/c') which
              are specified on
              input ports. The path references output ports which always exist.</p>
            <p>A path API in Usd has no correspondance in MaterialX. A MaterialX <code>FilePath</code> can be used in
              lieu of this, or
              path modification can be done via string changes.</p>
            <blockquote>
              <p>Note that MaterialX uses relative paths to form connections and does not allow for parent path syntax
                (such as "../"). This has the advantage of assuring that no connections are ever formed between ports
                which do not have the same parent. This rule appears for Usd as well, but it could be possible with
                absolute path usage to connect to arbitrary ports within the hierarchy.</p>
            </blockquote>
            <p>Note that there is a connection <code>edge</code> construct but this is only available within upstream
              traversal within an iterator.</p>
            <p>Downstream traversal is available in MaterialX relies on a caching system which is always dirtied on
              arbitrary attribute changes and not just connection changes.</p>

            <h3 id="materials">Materials</h3>
            <p>Usd represents a material as a node graph (container). This allows for arbitrary inputs and outputs to
              exist, with connections being made to child ports within the material.</p>
            <p>MaterialX used to have a similar concept for materials but only
              as a material "collection". As of version 1.38.6, material nodes were introduced
              (<code>surfacematerial</code> and <code>volumematerial</code>)
              which more closely matches existing DCC concepts such as "shading engines" in Maya.</p>
            <p>If bidirectional interop between Usd and MaterialX is performed, the question arises as to how handle the
              mapping.
            </p>
            <p>
              The following diagram shows the class hierarchy for Usd and MaterialX. It is mostly the discrepancy between
              have one as a graph and one as a pair of atomic nodes which allows for different approaches to mapping.
              <img src="images/usd_material_vs_mtlx_material.png" width="80%">
            </p>
            <p>Applications like Maya and Houdini have "graph containers"
              which more closely match a nodegraph.
              <ul>
              <li>If the Usd material graph is mapped to a MaterialX material then arbitrary inputs and outputs have no place to map to 
              and the interop is lossy.
              <li>MaterialX material nodes cannot be children of a translated Usd material, but perhaps could be created as additional materials
              referencing the same shader graph. This is a bit of a strange mapping and makes it difficult to perform the reverse mapping.
              <li>If the Usd material graph is mapped to a MaterialX nodegraph then it is no longer distinguishable as a "material".
                </ul>
               </p>
               Additionally, note that when if the chosen mapping is from a Usd material graph to a MaterialX material node, that
                the shader ports are <strong>output</strong> ports while for MaterialX they are <strong>input</strong>
                ports.
              </p>
              <p>
                Thus in Usd, these are output-to-output connections (as would occur in a MaterialX node-to-nodegraph)
                instead of input-to-output connections occurs with MaterialX node-to-node connections. The notebook shows the
                added logic complexity.</p>

            <h3>Ports</h3>
            <p>For the most parts Usd ports correspond 1:1 with MaterialX ports. At the time of writing MaterialX tokens do not correspond to Usd
            (tokens).</p>
            <p>Some differences to note:</p> 
            <ul>
              <li>There is a superset of possible types in Usd vs MaterialX. This includes types which indicate
                precision (e.g. half-float vs float), signed and unsigned types, and various array types.
                Usage of Usd with MaterialX definitions should avoid any type mapping issues for interop.
              </li>
              <li>Usd uses <code>asset</code> references vs MaterialX which has only file name references for image resources. At
                the current time binary resource references are not supported in MaterialX.</li>
              <li>Usd uses <code>token</code> to represent shader ports on materials.
                This requires additional parsing of the port name to discover if the port maps to a surface,
                displacement, or volume shader type in MaterialX. </li>
              <li>There is some minor string syntax difference for representing tuples in Usd versus MaterialX which requires
                some extra mapping logic.
              </li>
            </ul>

            <h3>Supported Nodes</h3>
            <p>Usd supports nodes which are not defined in MaterialX.
              As such there is no way to map these to MaterialX unless "dummy" nodes are added. </p>
            <p>If MaterialX and non-MaterialX graphs are under the same parent, if they do not reference by each other,
              it seems possible to extract MaterialX subgraphs out and merge them back in. (Note that this was not
              attempted in the notebook example)</p>

            <h3>Material Assignment</h3>
            <p>Though MaterialX can support material assignments via it's <code>look</code> API, this was not examined
              as the intent is to have Usd perform this role with the <code>look</code> interfaces being optional going
              forward with the 1.39 release.</p>

            <h3>Usd-based versus Material-based Integrations</h3>
            <p>As part of the "Libraries / Definitions" notebook export was examined for Maya and Houdini. The both work
              within the
              context of integration with Usd.</p>
            <p>Of note is that for Maya graphs MaterialX material nodes are currently disallowed but sub-graphs are
              allowed, while Houdini material nodes are allowed but sub-graphs are both not exportable.<br>
              <img src="images/houdini_disallowed_nodes.png" width="60%">
            </p>
            <p>This could be cause  some confusion as to how these map to MaterialX. (At time of
              writing Maya does not support MaterialX export so to be determined how each integration progresses).
              Additionally it will be interesting to see the approach taken by Blender for MaterialX export.</p>
            <p>Currently <b>only the MaterialX Graph Editor</b> works without the notion of mapping to a Usd "container"
              (material graph). That said if MaterialX import is supported it is possible some
              graph configurations are not supported or required some type of
              transformation such as "flattening" or remapping.</p>
              <img src="images/graph_editor_supported.png" width="60%">
            <p>These are still "early days" and will be interesting to see how
              this all works out.</p>

          </div>
        </div>
      </div>
    </div>
  </div>

</body>

</html>